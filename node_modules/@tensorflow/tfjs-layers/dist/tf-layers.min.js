!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@tensorflow/tfjs-core")):"function"==typeof define&&define.amd?define(["exports","@tensorflow/tfjs-core"],t):t(e.tf=e.tf||{},e.tf)}(this,function(e,t){"use strict";function n(e,t){function n(){this.constructor=e}sn(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function i(e,t,n,i){var r,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(o=(a<3?r(o):a>3?r(t,n,o):r(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}function r(e,t,n,i){return new(n||(n=Promise))(function(r,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})}function a(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,a&&(o=a[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(a,n[1])).done)return o;switch(a=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,a=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],a=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,a,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s}function o(e,t){if(Array.isArray(e)){for(var n=[],i=0;i<t;i++)n=n.concat(e);return n}return(n=new Array(t)).fill(e),n}function s(e,t){if(!e)throw new dn(t)}function l(e,t){for(var n=0,i=0,r=e;i<r.length;i++)r[i]===t&&n++;return n}function u(e){return 1===e.length?e[0]:e}function c(e){return Array.isArray(e)?e:[e]}function h(e){return Array.isArray(e)&&Array.isArray(e[0])}function p(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function d(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function f(e){return e.length<=1?e:-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,function(e,t){return t.toUpperCase()})}function g(e){return null===e||void 0===e?null:{className:e.getClassName(),config:e.getConfig()}}function m(e,t,n,i){if(void 0===t&&(t={}),void 0===n&&(n={}),void 0===i&&(i="object"),"string"==typeof e){var r=e,a=void 0;if(r in n)a=n[r];else if(r in fn)a=fn[r];else if(null==(a=t[r]))throw new hn("Unknown "+i+": "+e);return a}var o=e;if(null==o.className||null==o.config)throw new hn(i+": Improper config format: "+JSON.stringify(o)+".\n'className' and 'config' must set.");var s=o.className,l=void 0,u=void 0;if(s in n?(l=(I=n.get(s))[0],u=I[1]):s in fn?(l=(S=fn.className)[0],u=S[1]):s in t&&(l=(N=t[s])[0],u=N[1]),null==l)throw new hn("Unknown "+i+": "+s);if(null!=u){for(var c={},h=0,p=Object.keys(fn);h<p.length;h++)c[w=p[h]]=fn[w];for(var d=0,f=Object.keys(n);d<f.length;d++)c[w=f[d]]=n[w];o.config.customObjects=c;for(var g=ln({},fn),m=0,y=Object.keys(n);m<y.length;m++){w=y[m];fn[w]=n[w]}z=u(l,o.config);return fn=ln({},g),z}for(var g=ln({},fn),v=0,b=Object.keys(n);v<b.length;v++){var w=b[v];fn[w]=n[w]}var z=new l(o.config);return fn=ln({},g),z;var I,S,N}function y(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new hn("Expected Tensor length to be 1; got "+e.length);t=e[0]}else t=e;return t}function v(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return(e=e)[0];throw new hn("Expected exactly 1 Shape; got "+e.length)}return e}function b(e,t){return e<t?-1:e>t?1:0}function w(e,t){return-1*b(e,t)}function z(e){switch(e){case"float32":return"float32";default:throw new hn("Invalid dtype: "+e)}}function I(e){if(null==e)return e;for(var t=[],n=0,i=e;n<i.length;n++){var r=i[n];-1===t.indexOf(r)&&t.push(r)}return t}function S(e){if(null==e)throw new hn("Invalid value in obj: "+JSON.stringify(e));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function N(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new hn(n+" is not a valid "+t+".  Valid values are "+e+" or null/undefined.")}function k(e){N(mn,"DataFormat",e)}function C(e){N(yn,"PaddingMode",e)}function L(e){N(vn,"PoolMode",e)}function A(e,t){bn.push(e);try{var n=t();return bn.pop(),n}catch(e){throw bn.pop(),e}}function T(){return 0===bn.length?"":bn.join(wn)+wn}function R(e){if(!M(e))throw new Error("Not a valid tensor name: '"+e+"'");return T()+e}function D(e){if(!M(e))throw new Error("Not a valid tensor name: '"+e+"'");gn.has(e)||gn.set(e,0);var t=gn.get(e);if(gn.set(e,gn.get(e)+1),t>0){var n=e+"_"+t;return gn.set(n,1),n}return e}function M(e){return!!e.match(zn)}function O(e){return e===parseInt(e.toString(),10)}function F(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var i=1,r=t;r<n;++r)i*=e[r];return i}function x(e){return e=Array.isArray(e)?new Float32Array(e):e,t.tensor1d(e)}function E(e){return t.min(x(e)).dataSync()[0]}function P(e){return t.max(x(e)).dataSync()[0]}function _(e,t){if(t<e)throw new hn("end ("+t+") < begin ("+e+") is forbidden.");for(var n=[],i=e;i<t;++i)n.push(i);return n}function B(){return In++}function U(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}function j(e){return e.map(function(e){return e.read()})}function W(e){e.map(function(e){e[0].write(e[1])})}function V(){return"channelsLast"}function q(e,n){return void 0===n&&(n=Ln),null==An[n][e]&&(An[n][e]=t.scalar(e,n),t.keep(An[n][e])),An[n][e]}function Z(e){return e.shape}function K(e){return e.shape}function G(e){return e.shape.length}function H(e){return e instanceof t.Tensor?Ln:e.dtype}function J(e,t){return e.asType(t)}function X(e,t){void 0===t&&(t=-1);var n=Z(e).slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),e.reshape(n)}function $(e,n){return t.tidy(function(){if(2!==e.shape.length)throw new hn("repeat() expects a rank-2 tensor, but received a rank-"+e.shape.length+" tensor.");return le(X(e,1),[1,n,1])})}function Y(e){var t=[F(e.shape)];return e.reshape(t)}function Q(e){if(G(e)<=1)throw new hn("batchFlatten requires a minimum rank of 2. Got rank: "+G(e)+".");var t=[e.shape[0],F(e.shape,1)];return e.reshape(t)}function ee(e,n,i){return t.tidy(function(){switch(e.rank){case 1:return t.slice1d(e,n,i);case 2:return t.slice2d(e,[n,0],[i,e.shape[1]]);case 3:return t.slice3d(e,[n,0,0],[i,e.shape[1],e.shape[2]]);case 4:return t.slice4d(e,[n,0,0,0],[i,e.shape[1],e.shape[2],e.shape[3]]);default:throw new hn("sliceAlongFirstAxis() received an unsupported tensor rank: "+e.rank)}})}function te(e,n,i){return t.tidy(function(){switch(e.rank){case 1:return t.slice1d(e,n,i);case 2:return t.slice2d(e,[0,n],[e.shape[0],i]);case 3:return t.slice3d(e,[0,0,n],[e.shape[0],e.shape[1],i]);case 4:return t.slice4d(e,[0,0,0,n],[e.shape[0],e.shape[1],e.shape[2],i]);default:throw new hn("sliceAlongLastAxis() received an unsupported tensor rank: "+e.rank)}})}function ne(e,n,i,r){return t.tidy(function(){switch(e.rank){case 1:return t.slice1d(e,n,i);case 2:switch(r){case 1:return ee(e,n,i);case 2:return te(e,n,i);default:throw new hn("The axis is not within the rank of the tensor "+r)}case 3:switch(r){case 1:return ee(e,n,i);case 2:return t.slice3d(e,[0,n,0],[e.shape[0],i,e.shape[2]]);case 3:return te(e,n,i);default:throw new hn("The axis is not within the rank of the tensor "+r)}case 4:switch(r){case 1:return ee(e,n,i);case 2:return t.slice4d(e,[0,n,0,0],[e.shape[0],i,e.shape[2],e.shape[3]]);case 3:return t.slice4d(e,[0,0,n,0],[e.shape[0],e.shape[1],i,e.shape[3]]);case 4:return te(e,n,i);default:throw new hn("The axis is not within the rank of the tensor "+r)}default:throw new hn("sliceAlongLastAxis() received an unsupported tensor rank: "+e.rank)}})}function ie(e,n,i,r,a){return void 0===a&&(a=.001),t.tidy(function(){var o=t.moments(e,r),s=o.mean,l=o.variance;return[me(e,s,l,i,n,a),s,l]})}function re(e,n,i,r,a){return void 0===a&&(a=.001),t.tidy(function(){for(var o=t.moments(e,r),s=o.mean,l=o.variance,u=[],c=0,h=_(0,G(e));c<h.length;c++){var p=h[c];-1!==r.indexOf(p)?u.push(1):u.push(e.shape[p])}var d=s.reshape(u),f=l.reshape(u),g=null==n?null:n.reshape(u),m=null==i?null:i.reshape(u);return[me(e,d,f,m,g,a),s,l]})}function ae(e,n,i,r,a){return void 0===a&&(a=.001),t.util.arraysEqual(r.slice().sort(),_(0,G(e)-1))?ie(e,n,i,r,a):re(e,n,i,r,a)}function oe(e,n){void 0===n&&(n=-1);var i;return n<0&&(n=0!==(i=G(e[0]))?i:0),n===G(e[0])&&(n=-1),t.concat(e,n)}function se(e,n){switch(e.rank){case 1:return t.concat1d([e,n]);case 2:return t.concat2d([e,n],0);case 3:return t.concat3d([e,n],0);case 4:return t.concat4d([e,n],0);default:throw new hn("concatAlongFirstAxis() received an unsupported tensor rank: "+e.rank)}}function le(e,n){if(Array.isArray(n)||(n=[n]),G(e)!==n.length)throw new hn("The length of input n ("+n.length+") does not match the number of dimensions in input x ("+G(e)+")");return t.tile(e,n)}function ue(e){return e.clone()}function ce(e,n){return t.mul(e,n)}function he(e,n){return t.add(e,n)}function pe(e,n,i,r,a){return void 0===n&&(n=0),void 0===i&&(i=1),t.randomNormal(e,n,i,r,a)}function de(e,n){if(2!==G(n))throw new pn("dot support for y other than rank 2 is not yet implemented: y shape = "+Z);if(2===G(e))return t.matMul(e,n);if(3===G(e)){var i=e.shape[0],r=e.shape[1],a=e.shape[2];return e=e.reshape([i*r,a]),t.matMul(e,n).reshape([i,r,n.shape[1]])}throw new pn("dot support for x of rank "+G(e)+" is not yet implemented: x shape = "+Z)}function fe(e,n,i){return t.tidy(function(){return n=Array.isArray(n)?t.tensor1d(n,"int32"):n.toInt(),t.gather(e,n,i)})}function ge(e){return t.mulStrict(e,e)}function me(e,n,i,r,a,o){void 0===o&&(o=.001);var s;if(2===G(e))s=t.batchNormalization2d(e,n,i,o,a,r);else if(3===G(e))s=t.batchNormalization3d(e,n,i,o,a,r);else{if(4!==G(e))throw new pn("batchNormalization is not implememnted for array of rank "+G(e)+" yet");s=t.batchNormalization4d(e,n,i,o,a,r)}return s}function ye(e,n,i){return t.tidy(function(){if(null==i&&(i=V()),k(i),1!==G(n)&&G(n)!==G(e))throw new hn("Unexpected bias dimensions: "+G(n)+"; expected it to be 1 or "+G(e));var t,r=n.shape;if(5===G(e))"channelsFirst"===i?t=1===r.length?e.add(n.reshape([1,r[0],1,1,1])):e.add(n.reshape([1,r[3],r[0],r[1],r[2]])):"channelsLast"===i&&(t=1===r.length?e.add(n.reshape([1,1,1,1,r[0]])):e.add(n.reshape([1].concat(r))));else if(4===G(e))"channelsFirst"===i?t=1===r.length?e.add(n.reshape([1,r[0],1,1])):e.add(n.reshape([1,r[2],r[0],r[1]])):"channelsLast"===i&&(t=1===r.length?e.add(n.reshape([1,1,1,r[0]])):e.add(n.reshape([1].concat(r))));else if(3===G(e))"channelsFirst"===i?t=1===r.length?e.add(n.reshape([1,r[0],1])):e.add(n.reshape([1,r[1],r[0]])):"channelsLast"===i&&(t=1===r.length?e.add(n.reshape([1,1,r[0]])):e.add(n.reshape([1].concat(r))));else{if(!(G(e)<3))throw new hn("Unsupported input rank by biasAdd: "+G(e));t=e.add(n)}return t})}function ve(e,n){if(void 0===n&&(n=1),1!==n)throw new pn("Support for alpha values other than 1 ("+n+") is not implemented yet.");return t.elu(e)}function be(e){return t.tidy(function(){return t.div(e,t.add(q(1),t.abs(e)))})}function we(e,n,i,r){return t.tidy(function(){if(null!=i&&!t.util.arraysEqual(e.shape,i))throw new pn("Non-default noise shape is not implemented yet: "+JSON.stringify(i));if(null!=r)throw new pn("seed is not implemented for dropout yet.");var a=t.step(t.add(t.neg(n),t.randomUniform(e.shape,0,1,"float32")));return a=t.mul(t.div(q(1),t.sub(q(1),n)),a),t.mul(e,a)})}function ze(e,n){return t.tidy(function(){var i=t.sum(ge(e),n,!0),r=ce(t.scalar(Tn()),t.onesLike(e)),a=t.sqrt(t.maximum(i,r));return t.div(e,a)})}function Ie(e,t){return A(e,t)}function Se(){return"float32"}function Ne(e){return void 0===e&&(e=""),e in Rn||(Rn[e]=0),Rn[e]+=1,e+Rn[e].toString()}function ke(e,n,i){return void 0===i&&(i=!1),t.tidy(function(){if(i)n=t.softmax(n);else{var r=t.sum(n,Z(n).length-1,!0);n=t.div(n,r)}return n=t.clipByValue(n,Tn(),1-Tn()),t.neg(t.sum(t.mul(e.toFloat(),t.log(n)),Z(n).length-1))})}function Ce(e,n,i){return void 0===i&&(i=!1),t.tidy(function(){var r=t.floor(Y(e)).toInt(),a=Z(n);return ke(t.oneHot(r,a[a.length-1]).reshape(a),n,i)})}function Le(e,n,i){return void 0===i&&(i=!1),t.tidy(function(){var r;return i?r=n:(r=t.clipByValue(n,Tn(),1-Tn()),r=t.log(t.div(r,t.sub(t.onesLike(r),r)))),Ae(e,r)})}function Ae(e,n){return t.tidy(function(){var i=t.maximum(n,t.zerosLike(n)),r=t.mul(n,e),a=t.log(t.add(q(1),t.exp(t.neg(t.abs(n)))));return t.add(t.sub(i,r),a)})}function Te(e){return t.tidy(function(){var n=he(t.scalar(.5),ce(t.scalar(.2),e));return t.clipByValue(n,0,1)})}function Re(e,t,n){return void 0===n&&(n=!1),n?e():t()}function De(e,n){return t.tidy(function(){return t.sqrt(t.sum(ge(e),n,!0))})}function Me(e){return g(e)}function Oe(e,n){return void 0===n&&(n={}),m(e,t.serialization.SerializationMap.getMap().classNameMap,n,"constraint")}function Fe(e){return null==e?null:"string"==typeof e?Oe({className:e in En?En[e]:e,config:{}}):e instanceof Dn?e:Oe(e)}function xe(e,n){return void 0===n&&(n={}),m(e,t.serialization.SerializationMap.getMap().classNameMap,n,"layer")}function Ee(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}function Pe(e,t){if(null===e)return null;if("string"==typeof e)return f(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],i=e.length,r=0;r<i;++r){var a=e[r];Ee(t,r,a)?n.push(a):n.push(Pe(a,t))}return n}for(var o={},s=0,l=Object.keys(e);s<l.length;s++){var u=l[s],c=e[u];if("name"===u&&"string"==typeof c)o[u]=c;else{var h=f(u);o[h]=Pe(c,h)}}return o}function _e(e,t){if(null===e||void 0===e)return null;if("string"==typeof e)return d(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],i=e.length,r=0;r<i;++r){var a=e[r];Ee(t,r,a)?n.push(a):n.push(_e(a,t))}return n}for(var o={},s=0,l=Object.keys(e);s<l.length;s++){var u=l[s],c=e[u],h=d(u);o[h]="name"!==u&&"className"!==u||"string"!=typeof c?_e(c,u):c}return o}function Be(e){for(var t=[],n=0,i=e=c(e);n<i.length;n++){var r=i[n];t.push(K(r))}return u(t)}function Ue(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new hn("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n=Se()),new Wn({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}function je(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];var i=t.inboundNodes[n];if(0===i.inboundLayers.length)return i.inputTensors;for(var r=[],a=0;a<i.inboundLayers.length;a++)for(var o=0,s=je(i.inputTensors[a],i.inboundLayers[a],i.nodeIndices[a]);o<s.length;o++){var l=s[o];-1===r.indexOf(l)&&r.push(l)}return r}function We(e,n,i){var r=z(e);return t.Tensor.make(n,{values:0===n.length?i:t.util.flatten(i)},r)}function Ve(e,t,n,i){if(!n.startsWith("2."))throw new hn("Unsupported Keras version in weights being loaded: "+n);return t}function qe(e,t){for(var n={},i=0,r=0,a=t;r<a.length;r++)for(var o=0,s=a[r].weights;o<s.length;o++){var l=s[o];if(null!=n[l.originalName])throw new hn("Duplicate weight name: "+l.originalName);n[l.originalName]=l,i++}var u=[];for(var c in e)u.push([n[c],e[c]]),delete n[c];var h=[];for(var p in n)h.push(p);if(h.length>0)throw new hn(h.length+" of "+i+" weights are not set: "+h);W(u)}function Ze(e,n,i){void 0===i&&(i=!1);for(var r=e.keras_version,a=e.backend,o=n.map(function(e){return e.name}),s={},l=0,u=n;l<u.length;l++)null!=(w=u[l]).name&&(null==s[w.name]&&(s[w.name]=[]),s[w.name].push(w));for(var c=e.weights,h=[],p=0;p<o.length;++p){var d=o[p],f=c[d];null==f&&(f=[]);for(var g=[],m=0;m<f.length;++m){var y=f[m];g.push(new kn(We(y.dtype,y.shape,y.value)))}for(var v=0,b=s[d];v<b.length;v++){var w=b[v],z=w.weights;if((g=Ve(w,g,r,a)).length!==z.length){if(!i)throw new hn("Layer #"+p+' (named "'+w.name+'") expects '+z.length+" weight(s), but the saved weights have "+g.length+" element(s).");console.warn("Skipping loading of weights of layer "+w.name+" due to mismatch in number of weights: ("+g.length+" vs "+z.length+").")}for(var I=0;I<g.length;++I)!i||t.util.arraysEqual(z[I].shape,g[I].shape)?h.push([z[I],g[I].read()]):console.warn("Skipping loading of weights for layer "+w.name+" due to mismatch in shape ("+z[I].shape+" vs "+g[I].shape+")")}}W(h)}function Ke(e){return r(this,void 0,void 0,function(){var t,n,i,r,o,s,l;return a(this,function(a){switch(a.label){case 0:if(null==e)return[2];t=[],n=[];for(i in e)"number"!=typeof(r=e[i])&&(o=r,t.push(o.data()),n.push(i));return[4,Promise.all(t)];case 1:for(s=a.sent(),l=0;l<s.length;++l)e[n[l]]=s[l][0];return[2]}})})}function Ge(e){if(null!=e)for(var t in e){var n=e[t];"number"!=typeof n&&n.dispose()}}function He(e){return null==e?null:e instanceof Zn?[e]:Array.isArray(e)&&e[0]instanceof Zn?e:c(e).map(function(e){return new Jn(e)})}function Je(e,n){return t.tidy(function(){return t.mean(ge(t.sub(n,e)),-1)})}function Xe(e,n){return t.tidy(function(){return t.mean(t.abs(t.sub(n,e)),-1)})}function $e(e,n){return t.tidy(function(){var i=t.sub(e,n),r=t.clipByValue(t.abs(e),Tn(),Number.MAX_VALUE),a=t.abs(t.div(i,r));return ce(q(100),t.mean(a,-1))})}function Ye(e,n){return t.tidy(function(){var i=q(1),r=t.clipByValue(n,Tn(),Number.MAX_VALUE),a=t.log(he(i,r)),o=t.clipByValue(e,Tn(),Number.MAX_VALUE),s=t.log(he(i,o));return t.mean(ge(t.sub(a,s)),-1)})}function Qe(e,n){return t.tidy(function(){var i=q(0),r=q(1),a=t.maximum(i,t.sub(r,t.mul(e,n)));return t.mean(ge(a),-1)})}function et(e,n){return t.tidy(function(){var i=q(0),r=q(1),a=t.maximum(i,t.sub(r,t.mul(e,n)));return t.mean(a,-1)})}function tt(e,n){return t.tidy(function(){var i=q(0),r=q(1),a=t.sum(t.mul(e,n),-1),o=t.max(t.mul(t.sub(r,e),n),-1);return t.maximum(i,he(r,t.sub(o,a)))})}function nt(e,n){return t.tidy(function(){var i=q(Math.log(2)),r=t.sub(n,e),a=t.sub(t.add(r,t.softplus(ce(q(-2),r))),i);return t.mean(a,-1)})}function it(e,n){return t.tidy(function(){return ke(e,n)})}function rt(e,n){return t.tidy(function(){return Ce(e,n)})}function at(e,n){return t.tidy(function(){return t.mean(Le(e,n),-1)})}function ot(e,n){return t.tidy(function(){var i=t.clipByValue(e,Tn(),1),r=t.clipByValue(n,Tn(),1);return t.sum(t.mul(e,t.log(t.div(i,r))),-1)})}function st(e,n){return t.tidy(function(){var i=t.log(he(q(Tn()),n));return t.mean(t.sub(n,t.mul(e,i)),-1)})}function lt(e,n){return t.tidy(function(){var i=ze(e,-1),r=ze(n,-1),a=t.mul(i,r);return t.neg(t.sum(a,-1))})}function ut(e){var t={meanSquaredError:Je,meanAbsoluteError:Xe,meanAbsolutePercentageError:$e,meanSquaredLogarithmicError:Ye,squaredHinge:Qe,hinge:et,categoricalHinge:tt,logcosh:nt,categoricalCrossentropy:it,sparseCategoricalCrossentropy:rt,binaryCrossentropy:at,kullbackLeiblerDivergence:ot,poisson:st,cosineProximity:lt};if("string"==typeof e){if(e in t)return t[e];throw new hn("Unknown loss "+e)}return e}function ct(e,n){return t.tidy(function(){var i=ce(q(.5),t.onesLike(n)),r=J(t.greater(n,i),e.dtype);return t.mean(t.equal(e,r),-1)})}function ht(e,n){return t.tidy(function(){return J(t.equal(t.argMax(e,-1),t.argMax(n,-1)),"float32")})}function pt(e,n){return t.tidy(function(){return t.mean(Le(e,n),-1)})}function dt(e,t){throw new pn}function ft(e){var t={binaryAccuracy:ct,categoricalAccuracy:ht,categoricalCrossentropy:ni,sparseCategoricalCrossentropy:ri,mse:Xn,MSE:$n,mae:Yn,MAE:Qn,mape:ei,MAPE:ti,cosine:ii};if("string"==typeof e&&e in t)return t[e];if("string"!=typeof e&&null!=e)return e;throw new hn("Unknown metric "+e)}function gt(e){var n={Adagrad:function(){return t.train.adagrad(.01)},Adam:function(){return t.train.adam(.001,.9,.999,Tn())},RMSProp:function(){return t.train.rmsprop(.001,.9,null,Tn())},SGD:function(){return t.train.sgd(.01)}};if(n.adagrad=n.Adagrad,n.adam=n.Adam,n.rmsprop=n.RMSProp,n.sgd=n.SGD,e in n)return n[e]();throw new hn("Unknown Optimizer "+e)}function mt(e,t){if(null!=e.dtype&&e.dtype!==t.dtype)throw new hn("The dtype of the feed ("+t.dtype+") is incompatible with that of the key '"+e.name+"' ("+e.dtype+").");if(null!=e.shape){if(e.shape.length!==t.shape.length)throw new hn("The rank of feed ("+t.shape.length+") does not match the rank of the key ("+e.shape.length+").");for(var n=0;n<e.shape.length;++n)if(null!=e.shape[n]&&e.shape[n]!==t.shape[n])throw new hn("The "+n+"-th dimension of the feed ("+t.shape[n]+") is incompatible with that of the key ("+e.shape[n]+").")}}function yt(e,t,n){for(var i=Array.isArray(e),r=i?e:[e],a=[],o=new ai(t),s=0,l=r;s<l.length;s++){var u=l[s];a.push(vt(u,o,n))}return i?a:a[0]}function vt(e,t,n){if(t.hasKey(e))return t.getValue(e);if(e.sourceLayer instanceof Wn)throw new hn("Missing a feed value for SymbolicTensor from InputLayer '"+Wn.name+"'");for(var i=[],r=0,a=e.inputs;r<a.length;r++){var o=vt(a[r],t,n);i.push(o)}var s=e.sourceLayer.apply(i,n);Array.isArray(s)||(s=[s]);for(var l=bt(e),u=Array.isArray(l)?l:[l],c=0;c<u.length;++c)t.add(u[c],s[c]);return 1===s.length?s[0]:s[e.outputTensorIndex]}function bt(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,i=0;i<e.sourceLayer.inboundNodes.length;++i)for(var r=0,a=e.sourceLayer.inboundNodes[i].outputTensors;r<a.length;r++)if(a[r].id===e.id){n=i;break}t=e.sourceLayer.getOutputAt(n)}return t}function wt(e){return e instanceof t.Tensor}function zt(e){return Array.isArray(e)}function It(e){return!wt(e)&&!zt(e)}function St(e,t,n,i,r){if(void 0===i&&(i=!0),void 0===r&&(r=""),null==t||0===t.length){if(null!=e){var a=!1;if(zt(e)&&e.length>0)a=!0;else if(It(e)){for(var o in e)if(e.hasOwnProperty(o)){a=!0;break}}else a=!0;if(a)throw new hn("Error when checking model "+r+" expected no data, but got "+e)}return[]}if(null==e)return t.map(function(e){return null});var s;if(It(e)){e=e,s=[];for(var l=0,u=t;l<u.length;l++){var c=u[l];if(null==e[c])throw new hn('No data provided for "'+c+'". Need data for each key in: '+t);s.push(e[c])}}else if(zt(e)){if((e=e).length!==t.length)throw new hn("Error when checking model "+r+": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see "+t.length+" Tensor(s), but instead got the following list of Tensor(s): "+e);s=e}else{if(e=e,t.length>1)throw new hn("The model "+r+" expects "+t.length+" Tensor(s), but only received one Tensor. Found: Tensor with shape "+e.shape);s=[e]}for(h=0;h<t.length;++h)1===(p=s[h]).shape.length&&(s[h]=X(p,1));if(null!=n)for(var h=0;h<t.length;++h)if(null!=n[h]){var p=s[h];if(p.shape.length!==n[h].length)throw new hn("Error when checking "+r+": expected "+t[h]+" to have "+n[h].length+" dimension(s). but got array with shape "+p.shape);for(var d=0;d<n[h].length;++d)if(0!==d||i){var f=p.shape[d],g=n[h][d];if(null!=g&&g>=0&&f!==g)throw new hn("Error when checking "+r+": expected "+t[h]+" to have shape ["+n[h]+"], but got array with shape ["+p.shape+"].")}}return s}function Nt(e,n,i){var r=I(e.map(function(e){return e.shape[0]}));r.sort();var a=I(n.map(function(e){return e.shape[0]}));if(a.sort(),r.length>1)throw new hn("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(e.map(function(e){return e.shape})));if(a.length>1)throw new hn("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(n.map(function(e){return e.shape})));if(r.length>0&&a.length>0&&!t.util.arraysEqual(r,a))throw new hn("Input Tensors should have the same number of samples as target Tensors. Found "+r[0]+" input sample(s) and "+a[0]+" target sample(s).")}function kt(e,t,n){for(var i=[Je,at,it],r=0;r<e.length;++r){var a=e[r],o=t[r],s=n[r];if(null!=o){if(o===it&&1===a.shape[a.shape.length-1])throw new hn("You are passing a target array of shape "+a.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==i.indexOf(o))for(var l=a.shape.slice(1),u=s.slice(1),c=0;c<l.length;++c){var h=l[c],p=u[c];if(null!=p&&h!==p)throw new hn("A target Tensor with shape "+a.shape+" was passed for an output of shape "+s+", while using a loss function that expects targets to have the same shape as the output.")}}}}function Ct(e,t){for(var n=[],i=0,r=null;i<e;)(r=i+t)>=e&&(r=e),n.push([i,r]),i=r;return n}function Lt(e,t,n){return null==e?[null]:Array.isArray(e)?e.map(function(e){return ee(e,t,n-t)}):ee(e,t,n-t)}function At(e,t){return null==e?null:Array.isArray(e)?e.map(function(e){return At(e,t)}):fe(e,"int32"===t.dtype?t:t.toInt())}function Tt(e,t,n,i,r){void 0===i&&(i=!0),void 0===r&&(r="");var a;if(Array.isArray(e)){if(e.length!==t.length)throw new hn("Error when checking model "+r+": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see "+t.length+" Tensor(s), but instead got "+e.length+" Tensors(s).");a=e}else{if(t.length>1)throw new hn("The model expects "+t.length+" "+r+" Tensors, but only received one Tensor. Found: array with shape "+JSON.stringify(e.shape)+".");a=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=a[o];if(s.shape.length!==n[o].length)throw new hn("Error when checking "+r+": expected "+t[o]+" to have "+n[o].length+" dimension(s), but got array with shape "+JSON.stringify(s.shape));for(var l=0;l<n[o].length;++l)if(0!==l||i){var u=s.shape[l],c=n[o][l];if(null!=c&&c!==u)throw new hn("Error when checking "+r+": expected "+t[o]+" to have shape "+JSON.stringify(n[o])+" but got array with shape "+JSON.stringify(s.shape)+".")}}}function Rt(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map(function(e){return[]});if(Array.isArray(e))return t.map(function(t){return e});if(null!=e){for(var n=[],i=0,r=t;i<r.length;i++){var a=r[i],o=e.hasOwnProperty(a)?e[a]:[];Array.isArray(o)||(o=[o]),n.push(o)}return n}throw new TypeError("Type of metrics argument not understood. Expected an Array or Object, found: "+e)}function Dt(e){N(si,"FanMode",e)}function Mt(e){N(li,"Distribution",e)}function Ot(e,t){void 0===t&&(t="channelsLast");var n,i;if(k(t),2===e.length)n=e[0],i=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===t){r=F(e,2);n=e[1]*r,i=e[0]*r}else if("channelsLast"===t){var r=F(e,0,e.length-2);n=e[e.length-2]*r,i=e[e.length-1]*r}}else{var a=F(e);n=Math.sqrt(a),i=Math.sqrt(a)}return[n,i]}function Ft(e,n){return void 0===n&&(n={}),m(e,t.serialization.SerializationMap.getMap().classNameMap,n,"initializer")}function xt(e){return g(e)}function Et(e){if("string"==typeof e){var t=e in Si?Si[e]:e;return"GlorotUniform"===t?new vi:"GlorotNormal"===t?new bi:"HeNormal"===t?new wi:"LeCunNormal"===t?new zi:Ft({className:t,config:{}})}return e instanceof ui?e:Ft(e)}function Pt(e){return e.getClassName()}function _t(e,n){return void 0===n&&(n={}),m(e,t.serialization.SerializationMap.getMap().classNameMap,n,"activation")}function Bt(e){if(null==e)return _t(t={className:"linear",config:{}});if("string"==typeof e){var t={className:e,config:{}};return _t(t)}return e instanceof Ni?e:_t(e)}function Ut(e){return new ji({l1:null!=e?e.l1:null,l2:0})}function jt(e){return new ji({l2:null!=e?e.l2:null,l1:0})}function Wt(e){return g(e)}function Vt(e,n){return void 0===n&&(n={}),m(e,t.serialization.SerializationMap.getMap().classNameMap,n,"regularizer")}function qt(e){return null==e?null:"string"==typeof e?Vt({className:e in Wi?Wi[e]:e,config:{}}):e instanceof Ui?e:Vt(e)}function Zt(e,t,n){if("number"==typeof e)return o(e,t);if(e.length!==t)throw new hn("The "+n+" argument must be a tuple of "+t+" integers. Received: "+e.length+" elements.");for(var i=0;i<t;++i){var r=e[i];if(!O(r))throw new hn("The "+n+" argument must be a tuple of "+t+" integers. Received: "+JSON.stringify(e)+" including a non-integer number "+r)}return e}function Kt(e,t,n,i,r){if(void 0===r&&(r=1),null==e)return e;var a,o=t+(t-1)*(r-1);return a="same"===n?e:e-o+1,Math.floor((a+i-1)/i)}function Gt(e,t,n,i){if(null==e)return null;if("valid"===i)e=e*t+P([n-t,0]);else{if("same"!==i)throw new hn("Unsupport padding mode: "+i+".");e*=t}return e}function Ht(e,n){return t.tidy(function(){return k(n),"channelsFirst"===n?t.transpose(e,[0,2,3,1]):e})}function Jt(e,n,i,r,a,o,s){return void 0===r&&(r=1),void 0===a&&(a="valid"),void 0===s&&(s=1),t.tidy(function(){if(null==o&&(o=V()),k(o),3!==e.shape.length)throw new hn("The input of a conv1dWithBias operation should be 3, but is "+e.shape.length+" instead.");if(3!==n.shape.length)throw new hn("The kernel for a conv1dWithBias operation should be 3, but is "+n.shape.length+" instead");if(null!=i&&1!==i.shape.length)throw new hn("The bias for a conv1dWithBias operation should be 1, but is "+n.shape.length+" instead");if("channelsFirst"===o&&(e=t.transpose(e,[0,2,1])),"causal"===a)throw new pn("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var l=t.conv1d(e,n,r,"same"===a?"same":"valid","NWC",s);return null!=i&&(l=ye(l,i)),l})}function Xt(e,n,i,r,a,o,s){return void 0===r&&(r=[1,1]),void 0===a&&(a="valid"),t.tidy(function(){if(null==o&&(o=V()),k(o),3!==G(e)&&4!==G(e))throw new hn("conv2dWithBias expects input to be of rank 3 or 4, but received "+G(e)+".");if(3!==G(n)&&4!==G(n))throw new hn("conv2dWithBias expects kernel to be of rank 3 or 4, but received "+G(e)+".");var l=Ht(e,o);if("causal"===a)throw new pn("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=t.conv2d(l,n,r,"same"===a?"same":"valid","NHWC",s),null!=i&&(l=ye(l,i)),"channelsFirst"===o&&(l=t.transpose(l,[0,3,1,2])),l})}function $t(e,n,i,r,a,o){return void 0===i&&(i=[1,1]),void 0===r&&(r="valid"),t.tidy(function(){null==a&&(a=V()),k(a);var s=Ht(e,a);if(4!==G(e))throw new hn("Input for depthwiseConv2d is required to be 4-D, but is instead "+G(e)+"-D");if(4!==G(n))throw new hn("depthwiseKernel is required to be 4-D, but is instead "+G(n)+"-D");return s=t.depthwiseConv2d(s,n,i,"same"===r?"same":"valid","NHWC",o),"channelsFirst"===a&&(s=t.transpose(s,[0,3,1,2])),s})}function Yt(e,n,i){return t.tidy(function(){if(4!==G(e))throw new hn("temporalPadding expects input tensor to be 4-D, but received a "+G(e)+"-D tensor.");if(null==n&&(n=[[1,1],[1,1]]),2!==n.length||2!==n[0].length||2!==n[1].length)throw new hn("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==i&&(i=V()),"channelsLast"!==i&&"channelsFirst"!==i)throw new hn("Unknown data format: "+i+". Supported data formats are 'channelsLast' and 'channelsFirst.");var r;return r="channelsFirst"===i?[[0,0],[0,0],n[0],n[1]]:[[0,0],n[0],n[1],[0,0]],t.pad(e,r)})}function Qt(e,n,i,r,a,o){return t.tidy(function(){k(a),L(o),C(r),null==i&&(i=[1,1]),null==r&&(r="valid"),null==a&&(a=V()),null==o&&(o="max"),e=Ht(e,a);var s,l="same"===r?"same":"valid";return s="max"===o?t.maxPool(e,n,i,l):t.avgPool(e,n,i,l),"channelsFirst"===a&&(s=t.transpose(s,[0,3,1,2])),s})}function en(e,n,i,r,a,o,s,l){void 0===r&&(r=!1),void 0===s&&(s=!1);var u=n.shape.length;if(u<3)throw new hn("Input should be at least 3D, but is "+u+"D.");var c=[1,0].concat(_(2,u));if(n=t.transpose(n,c),null!=a)throw new pn("The rnn() function of the deeplearn.js backend does not support masking yet.");if(null!=o)throw new pn("The rnn() functoin of the deeplearn.js backend does not support constants yet.");s&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r&&(n=t.reverse(n,0));for(var h,p,d=i,f=n.shape[0],g=0;g<f;++g){var m=ee(n,g,1),y=e(m=m.reshape(m.shape.slice(1)),d);p=y[0],h=0===g?p.reshape([1].concat(p.shape)):se(h,p.reshape([1].concat(p.shape))),d=y[1]}return[p,t.transpose(h,[1,0].concat(_(2,h.shape.length))),d]}function tn(e){N(xr,"BidirectionalMergeMode",e)}function nn(e,n){return r(this,void 0,void 0,function(){var i,r,o,s,l,u,c,h,p,d;return a(this,function(a){switch(a.label){case 0:return null!=(i=e.modelTopology).model_config&&(i=i.model_config),r=Pe(i),o=xe(r,n),null==e.weightsManifest?[3,2]:[4,t.io.loadWeights(e.weightsManifest,e.pathPrefix,o.weights.map(function(e){return e.originalName}))];case 1:for(s=a.sent(),l={},u=0,c=o.weights;u<c.length;u++)h=c[u],l[h.originalName]=s[h.originalName];p=null,d=!0,o.loadWeights(l,p,d),a.label=2;case 2:return[2,o]}})})}function rn(e){return r(this,void 0,void 0,function(){var n;return a(this,function(i){if("string"==typeof e){if(0===(n=t.io.getLoadHandlers(e)).length)return[2,on(e)];if(n.length>1)throw new hn("Found more than one ("+n.length+") load handlers for URL '"+e+"'");e=n[0]}return[2,an(e)]})})}function an(e,n){return r(this,void 0,void 0,function(){var i,r,o,s;return a(this,function(a){switch(a.label){case 0:if(null==e.load)throw new hn("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,e.load()];case 1:if(i=a.sent(),r=xe(Pe(i.modelTopology),n),null!=i.weightData){if(null==i.weightSpecs)throw new hn("Model artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");o=!1,s=!0,r.loadWeights(t.io.decodeWeights(i.weightData,i.weightSpecs),o,s)}return[2,r]}})})}function on(e){return r(this,void 0,void 0,function(){var t,n;return a(this,function(i){switch(i.label){case 0:return[4,fetch(e)];case 1:return t=i.sent(),[4,t.json()];case 2:if(null==(n=i.sent()).modelTopology)throw new hn('Missing field "modelTopology" from model JSON at path'+e);if(null==n.weightsManifest)throw new hn('Missing field "weightsManifest" from model JSON at path'+e);return n.pathPrefix=e.substring(0,e.lastIndexOf("/")),[2,nn(n)]}})})}var sn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},ln=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},un=function(e){function t(n){var i=e.call(this,n)||this;return Object.setPrototypeOf(i,t.prototype),i}return n(t,e),t}(Error),cn=function(e){function t(n){var i=e.call(this,n)||this;return Object.setPrototypeOf(i,t.prototype),i}return n(t,e),t}(Error),hn=function(e){function t(n){var i=e.call(this,n)||this;return Object.setPrototypeOf(i,t.prototype),i}return n(t,e),t}(Error),pn=function(e){function t(n){var i=e.call(this,n)||this;return Object.setPrototypeOf(i,t.prototype),i}return n(t,e),t}(Error),dn=function(e){function t(n){var i=e.call(this,n)||this;return Object.setPrototypeOf(i,t.prototype),i}return n(t,e),t}(Error),fn=(function(e){function t(n){var i=e.call(this,n)||this;return Object.setPrototypeOf(i,t.prototype),i}n(t,e)}(Error),{}),gn=new Map,mn=["channelsFirst","channelsLast"],yn=["valid","same","causal"],vn=["max","avg"],bn=[],wn="/",zn=new RegExp(/^[A-Za-z][A-Za-z0-9\._\/]*$/),In=0,Sn=function(){function e(e,t,n,i,r,a,o){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=i,this.callArgs=r,this.outputTensorIndex=o,this.id=B(),null!=a&&(this.originalName=R(a),this.name=D(this.originalName))}return e=i([t.doc({heading:"Models",subheading:"Classes"})],e)}(),Nn="Variable",kn=function(){function e(e,n,i,r,a){void 0===n&&(n="float32"),void 0===i&&(i=Nn),void 0===r&&(r=!0),void 0===a&&(a=null),this.dtype=null==n?"float32":n,this.shape=e.shape,this.id=B(),i=null==i?Nn:i,this.originalName=R(i),this.name=D(this.originalName),this.trainable=r,this.constraint=a,this.val=t.variable(e,this.trainable,this.name,this.dtype)}return e.prototype.read=function(){return this.val},e.prototype.write=function(e){return U(this.val,e),this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val)),this},e}(),Cn=1e-7,Ln="float32",An={float32:{},int32:{}},Tn=function(){return Cn},Rn={},Dn=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return n(r,e),r.prototype.getConfig=function(){return{}},r=i([t.doc({heading:"Constraints",subheading:"Classes",namespace:"constraints"})],r)}(t.serialization.Serializable),Mn=function(e){function i(t){var n=e.call(this)||this;return n.defaultMaxValue=2,n.defaultAxis=0,n.maxValue=null!=t.maxValue?t.maxValue:n.defaultMaxValue,n.axis=null!=t.axis?t.axis:n.defaultAxis,n}return n(i,e),i.prototype.apply=function(e){var n=this;return t.tidy(function(){var i=De(e,n.axis),r=t.clipByValue(i,0,n.maxValue);return t.mul(e,t.div(r,he(q(Tn()),i)))})},i.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},i.className="MaxNorm",i}(Dn);t.serialization.SerializationMap.register(Mn);var On=function(e){function i(t){var n=e.call(this)||this;return n.defaultAxis=0,n.axis=null!=t.axis?t.axis:n.defaultAxis,n}return n(i,e),i.prototype.apply=function(e){var n=this;return t.tidy(function(){return t.div(e,he(q(Tn()),De(e,n.axis)))})},i.prototype.getConfig=function(){return{axis:this.axis}},i.className="UnitNorm",i}(Dn);t.serialization.SerializationMap.register(On);var Fn=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return n(i,e),i.prototype.apply=function(e){return t.relu(e)},i.className="NonNeg",i}(Dn);t.serialization.SerializationMap.register(Fn);var xn=function(e){function i(t){var n=e.call(this)||this;return n.defaultMinValue=0,n.defaultMaxValue=1,n.defaultRate=1,n.defaultAxis=0,n.minValue=null!=t.minValue?t.minValue:n.defaultMinValue,n.maxValue=null!=t.maxValue?t.maxValue:n.defaultMaxValue,n.rate=null!=t.rate?t.rate:n.defaultRate,n.axis=null!=t.axis?t.axis:n.defaultAxis,n}return n(i,e),i.prototype.apply=function(e){var n=this;return t.tidy(function(){var i=De(e,n.axis),r=t.add(ce(q(n.rate),t.clipByValue(i,n.minValue,n.maxValue)),ce(q(1-n.rate),i));return t.mul(e,t.div(r,he(q(Tn()),i)))})},i.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},i.className="MinMaxNorm",i}(Dn);t.serialization.SerializationMap.register(xn);var En={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"},Pn=function(){return function(e){this.dtype=e.dtype,this.shape=e.shape,null!=e.shape?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}(),_n=0,Bn=function(){function e(e,t){this.callArgs=t,this.id=_n++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(var n=0,i=e.inboundLayers;n<i.length;n++){var r=i[n];null!=r&&r.outboundNodes.push(this)}e.outboundLayer.inboundNodes.push(this)}return e.prototype.getConfig=function(){for(var e=[],t=0,n=this.inboundLayers;t<n.length;t++){var i=n[t];null!=i?e.push(i.name):e.push(null)}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},e}(),Un=0,jn=function(e){function r(t){var n=e.call(this)||this;n._callHook=null,n._addedWeightNames=[],n._stateful=!1,n.id=Un++,n.activityRegularizer=null,n.inputSpec=null,n.supportsMasking=!1,n._trainableWeights=[],n._nonTrainableWeights=[],n._losses=[],n._updates=[],n._built=!1,n.inboundNodes=[],n.outboundNodes=[];var i=t.name;if(!i){var r=n.getClassName();i=d(r)+"_"+Ne(r)}if(n.name=i,n.trainable=null==t.trainable||t.trainable,n.updatable=null==t.updatable||t.updatable,null!=t.inputShape||null!=t.batchInputShape){var a=void 0;if(null!=t.batchInputShape)a=t.batchInputShape;else if(null!=t.inputShape){var o=null;null!=t.batchSize&&(o=t.batchSize),a=[o].concat(t.inputShape)}n.batchInputShape=a;var s=t.dtype;null==s&&(s=t.inputDType),null==s&&(s=Se()),n.dtype=s}return null!=t.weights?n.initialWeights=t.weights:n.initialWeights=null,n}return n(r,e),r.nodeKey=function(e,t){return e.name+"_ib-"+t.toString()},r.prototype.getNodeAtIndex=function(e,t){if(0===this.inboundNodes.length)throw new cn("The layer has never been called and thus has no defined "+t+".");if(this.inboundNodes.length<=e)throw new hn("Asked to get "+t+" at node "+e+", but the layer has only "+this.inboundNodes.length+" inbound nodes.");return this.inboundNodes[e]},r.prototype.getInputAt=function(e){return u(this.getNodeAtIndex(e,"input").inputTensors)},r.prototype.getOutputAt=function(e){return u(this.getNodeAtIndex(e,"output").outputTensors)},Object.defineProperty(r.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new un("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new un("Layer "+this.name+" is not connected, no input to return.");return u(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"output",{get:function(){if(0===this.inboundNodes.length)throw new un("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new un("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return u(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),r.prototype.calculateLosses=function(){return this.losses.map(function(e){return e()})},Object.defineProperty(r.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"built",{get:function(){return this._built},set:function(e){this._built=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"trainableWeights",{get:function(){return this.trainable?this._trainableWeights:[]},set:function(e){this._trainableWeights=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._nonTrainableWeights:this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),r.prototype.assertInputCompatibility=function(e){if(e=c(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=c(this.inputSpec);if(e.length!==t.length)throw new hn("Layer "+this.name+" expects "+t.length+" inputs, but it received "+e.length+" input tensors. Input received: "+e);for(var n=0;n<e.length;n++){var i=e[n],r=t[n];if(null!=r){var a=G(i);if(null!=r.ndim&&a!==r.ndim)throw new hn("Input "+n+" is incompatible with layer "+this.name+": expected ndim="+r.ndim+", found ndim="+a);if(null!=r.maxNDim&&a>r.maxNDim)throw new hn("Input "+n+" is incompatible with layer "+this.name+": expected max_ndim="+r.maxNDim+", found ndim="+a);if(null!=r.minNDim&&a<r.minNDim)throw new hn("Input "+n+" is incompatible with layer "+this.name+": expected min_ndim="+r.minNDim+", found ndim="+a+".");if(null!=r.dtype&&H(i)!==r.dtype){var o=H(i);throw new hn("Input "+n+" is incompatible with layer "+this.name+" : expected dtype="+r.dtype+", found dtype="+o+".")}if(r.axes){p=K(i);for(var s in r.axes){var l=Number(s),u=r.axes[s],h=l>=0?p[l]:p[p.length+l];if(null!=u&&-1===[u,null].indexOf(h))throw new hn("Input "+n+" is incompatible with layer "+this.name+": expected axis "+l+" of input shape to have value "+u+" but got shape "+p+".")}}if(null!=r.shape)for(var p=K(i),d=0;d<r.shape.length;++d){var f=r.shape[d],g=p[d];if(null!=f&&null!=g&&f!==g)throw new hn("Input "+n+" is incompatible with layer "+this.name+": expected shape="+r.shape+", found shape=${xShape}.")}}}}},r.prototype.call=function(e,t){return e},r.prototype.invokeCallHook=function(e,t){null!=this._callHook&&this._callHook(e,t)},r.prototype.setCallHook=function(e){this._callHook=e},r.prototype.clearCallHook=function(){this._callHook=null},r.prototype.apply=function(e,t){var n=this;t=t||{};for(var i=c(e),r=!0,a=0,o=i;a<o.length;a++)if(!((p=o[a])instanceof Sn)){r=!1;break}for(var s=!0,l=0,h=i;l<h.length;l++){var p=h[l];if(p instanceof Sn){s=!1;break}}if(r===s)throw new hn("Arguments to apply() must be all SymbolicTensors or all Tensors");return Ie(this.name,function(){if(!n.built){n.assertInputCompatibility(e);for(var r=[],a=0,o=c(e);a<o.length;a++){var l=o[a];r.push(K(l))}n.build(u(r)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights)}if(n.assertInputCompatibility(e),s){for(var h=[],p=0,d=c(y=n.call(e,t));p<d.length;p++){var f=d[p];-1!==i.indexOf(f)&&(f=ue(f)),h.push(f)}if(y=u(h),null!=n.activityRegularizer)throw new pn("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return y}var g=Be(e),m=n.computeOutputShape(g),y=void 0;if(y=null!=m&&m.length>0&&Array.isArray(m[0])?m.map(function(i,r){return new Sn("float32",i,n,c(e),t,n.name,r)}):new Sn("float32",m,n,c(e),t,n.name),n.addInboundNode(e,y,null,null,g,m,t),null!=n.activityRegularizer)throw new pn("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return y})},r.prototype.build=function(e){this.built=!0},r.prototype.getWeights=function(e){return void 0===e&&(e=!1),j(e?this.trainableWeights:this.weights)},r.prototype.setWeights=function(e){var n=this;t.tidy(function(){var i=n.weights;if(i.length!==e.length)throw new hn('You called setWeights(weights) on layer "'+n.name+'" with a weight list of length '+e.length+", but the layer was expecting "+i.length+" weights. Provided weights: "+e+"...");if(0!==i.length){for(var r=[],a=j(i),o=0;o<a.length;++o){var s=a[o],l=i[o],u=e[o];if(!t.util.arraysEqual(s.shape,u.shape))throw new hn("Layer weight shape "+s.shape+" not compatible with provided weight shape "+u.shape);r.push([l,u])}W(r)}})},r.prototype.addWeight=function(e,t,n,i,r,a,o){if(-1!==this._addedWeightNames.indexOf(e))throw new hn("Duplicate weight name "+e+" for layer "+this.name);this._addedWeightNames.push(e),null==n&&(n=Se());var s=new kn(i.apply(t,n),n,e,a,o);return null!=r&&this.addLoss(function(){return r.apply(s.read())}),null==a&&(a=!0),a?this._trainableWeights.push(s):this._nonTrainableWeights.push(s),s},r.prototype.addLoss=function(e){if(!(null==e||Array.isArray(e)&&0===e.length)){e=c(e),void 0!==this._losses&&null!==this._losses&&(t=this.losses).push.apply(t,e);var t}},r.prototype.computeOutputShape=function(e){return e},r.prototype.computeMask=function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer "+this.name+" does not support masking,but was passed an inputMask.");t.forEach(function(e){if(null!=e)throw new TypeError("Layer "+n.name+" does not support masking,but was passed an inputMask.")})}return null}return t},r.prototype.addInboundNode=function(e,t,n,i,r,a,o){void 0===o&&(o=null);var s=c(e);t=c(t),n=c(n),i=c(i),r=p(r),a=p(a);for(var l=[],u=[],h=[],d=0,f=s;d<f.length;d++){var g=f[d];l.push(g.sourceLayer),u.push(g.nodeIndex),h.push(g.tensorIndex)}new Bn({outboundLayer:this,inboundLayers:l,nodeIndices:u,tensorIndices:h,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:i,inputShapes:r,outputShapes:a},o);for(var m=0;m<t.length;m++)t[m].sourceLayer=this,t[m].nodeIndex=this.inboundNodes.length-1,t[m].tensorIndex=m},r.prototype.getConfig=function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e},i([t.doc({heading:"Models",subheading:"Classes"})],r.prototype,"apply",null),r=i([t.doc({heading:"Layers",subheading:"Classes",namespace:"layers"})],r)}(t.serialization.Serializable),Wn=function(e){function t(t){var n=e.call(this,{dtype:t.dtype,name:null!=t.name?t.name:Ne("input").toString()})||this;if(null==t.batchSize&&(t.batchSize=null),null==t.sparse&&(t.sparse=!1),n.trainable=!1,n.built=!0,n.sparse=t.sparse,null!=t.inputShape&&null!=t.batchInputShape)throw new hn("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var i=t.batchInputShape;if(null==i){if(null==t.inputShape)throw new hn("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");i=[t.batchSize].concat(t.inputShape)}else if(null!=t.batchSize)throw new hn("Cannot specify batchSize if batchInputShape isspecified when creating an InputLayer.");var r=t.dtype||Se();n.batchInputShape=i,n.dtype=r,n.inputSpec=[{shape:i}];var a=new Sn(n.dtype,n.batchInputShape,n,[],{},n.name);return a.nodeIndex=0,a.tensorIndex=0,new Bn({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[a],outputTensors:[a],inputMasks:[null],outputMasks:[null],inputShapes:[i],outputShapes:[i]}),n}return n(t,e),t.prototype.apply=function(e,t){throw new hn("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)},t.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},t.className="InputLayer",t}(jn);t.serialization.SerializationMap.register(Wn);var Vn,qn=function(e){function r(t){var n=e.call(this,{})||this;if(n.containerNodes=new Set,n.name=t.name,null==n.name){var i=n.getClassName().toLowerCase();n.name=Ne(i)}if(n.supportsMasking=!1,n.trainable=!0,n.updatable=!0,Array.isArray(t.inputs)?n.inputs=t.inputs.slice():n.inputs=[t.inputs],Array.isArray(t.outputs)?n.outputs=t.outputs.slice():n.outputs=[t.outputs],I(n.inputs).length!==n.inputs.length)throw new hn("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+n.inputs.map(function(e){return e.name}));I(n.outputs).length!==n.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+n.outputs.map(function(e){return e.name})),n.inputLayers=[],n.inputLayersNodeIndices=[],n.inputLayersTensorIndices=[],n.outputLayers=[],n.outputLayersNodeIndices=[],n.outputLayersTensorIndices=[],n.layers=[];for(var a=0,o=n.outputs;a<o.length;a++){var l=(ie=o[a]).sourceLayer,u=ie.nodeIndex,c=ie.tensorIndex;n.outputLayers.push(l),n.outputLayersNodeIndices.push(u),n.outputLayersTensorIndices.push(c)}for(var h=0,p=n.inputs;h<p.length;h++){var l=(ie=p[h]).sourceLayer,u=ie.nodeIndex,c=ie.tensorIndex;s(0===u,"input layer has >1 nodes"),s(0===c,"input layer has >1 tensors"),n.inputLayers.push(l),n.inputLayersNodeIndices.push(u),n.inputLayersTensorIndices.push(c)}n.inputNames=[],n.outputNames=[],n.feedInputShapes=[],n.feedInputNames=[],n.feedOutputNames=[];for(M=0;M<n.inputLayers.length;M++){if(!((l=n.inputLayers[M])instanceof Wn))throw new TypeError("Input layers to a Model must be InputLayer objects. Received inputs: "+t.inputs+". Input "+M+" (0-based) originates from layer type "+l.getClassName()+".");n.inputNames.push(l.name),n.feedInputShapes.push(l.batchInputShape),n.feedInputNames.push(l.name)}for(var d=0,f=n.outputLayers;d<f.length;d++){l=f[d];n.outputNames.push(l.name)}n.internalInputShapes=n.inputs.map(function(e){return e.shape}),n.internalOutputShapes=n.outputs.map(function(e){return e.shape});for(var g={},m={},y={},v={},b={},z=[],S=function(e,t,i,a,o,s){null!=a&&null!=o&&null!=s||(a=e.sourceLayer,o=e.nodeIndex,s=e.tensorIndex);var l=a.inboundNodes[o];if(-1!==i.indexOf(l))throw new cn("The tensor "+e.name+' at layer "'+a.name+'" is part of a cycle.');if(-1===t.indexOf(l)){n.containerNodes.add(r.nodeKey(a,o)),a.id in b||(b[a.id]=Object.keys(b).length),-1===i.indexOf(l)&&i.push(l);for(var u=l.inboundLayers.length,c=0;c<u;c++){var h=l.inputTensors[c],p=l.inboundLayers[c],d=l.nodeIndices[c],f=l.tensorIndices[c];S(h,t,i,p,d,f)}for(t.push(l);i.indexOf(l)>=0;)i.splice(i.indexOf(l),1);z.push(l)}},N=[],k=[],C=0,L=n.outputs;C<L.length;C++){ie=L[C];S(ie,N,k)}for(var A=0,T=z.slice().reverse();A<T.length;A++){m[(Y=T[A]).id]=Y,Y.id in g||(g[Y.id]=0);var R=g[Y.id],D=null==y[Y.outboundLayer.id]?0:y[Y.outboundLayer.id];R=Math.max(R,D),y[Y.outboundLayer.id]=R,v[Y.outboundLayer.id]=Y.outboundLayer,g[Y.id]=R;for(var M=0;M<Y.inboundLayers.length;M++){var O=Y.inboundLayers[M],u=Y.nodeIndices[M],F=O.inboundNodes[u],x=null==g[F.id]?0:g[F.id];g[F.id]=Math.max(R+1,x),m[F.id]=F}}var E={};for(var P in g)(R=g[P])in E||(E[R]=[]),E[R].push(m[P]);var _={};for(var B in y)(R=y[B])in _||(_[R]=[]),_[R].push(v[B]);var U=Object.keys(_).map(function(e){return parseInt(e,10)}).sort(w);n.layers=[];for(var j=0,W=U;j<W.length;j++){var V=_[R=W[j]];V.sort(function(e,t){var n=b[e.id],i=b[t.id];return n<i?-1:n>i?1:0});for(var q=0,Z=V;q<Z.length;q++){l=Z[q];n.layers.push(l)}}n.layersByDepth=_,U=Object.keys(E).map(function(e){return parseInt(e,10)}).sort(w);for(var K=n.inputs.slice(),G=[],H=0,J=U;H<J.length;H++)for(var X=0,$=E[R=J[H]];X<$.length;X++){var Y=$[X];if(null!=(l=Y.outboundLayer)){for(var Q=0,ee=Y.inputTensors;Q<ee.length;Q++){ie=ee[Q];if(-1===K.indexOf(ie))throw new cn("Graph disconnected: cannot obtain value for tensor "+ie+' at layer "'+l.name+'". The following previous layers were accessed without issue: '+G)}for(var te=0,ne=Y.outputTensors;te<ne.length;te++){var ie=ne[te];K.push(ie)}G.push(l.name)}}n.nodesByDepth=E;for(var re=n.layers.map(function(e){return e.name}),ae=0,oe=re;ae<oe.length;ae++)!function(e){var t=re.filter(function(t){return t===e}).length;if(1!==t)throw new cn('The name "'+e+'" is used '+t+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(re))}(oe[ae]);return n.outboundNodes=[],n.inboundNodes=[],new Bn({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:n.inputs,outputTensors:n.outputs,inputMasks:n.inputs.map(function(e){return null}),outputMasks:n.outputs.map(function(e){return null}),inputShapes:n.inputs.map(function(e){return e.shape}),outputShapes:n.outputs.map(function(e){return e.shape})}),n.built=!0,n}return n(r,e),Object.defineProperty(r.prototype,"trainableWeights",{get:function(){if(this._trainableWeights.length>0)throw new hn("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];for(var e=[],t=0,n=this.layers;t<n.length;t++){var i=n[t];e=e.concat(i.trainableWeights)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"nonTrainableWeights",{get:function(){for(var e=[],t=0,n=this.layers;t<n.length;t++){o=n[t];e.push.apply(e,o.nonTrainableWeights)}if(!this.trainable){for(var i=[],r=0,a=this.layers;r<a.length;r++){var o=a[r];i.push.apply(i,o.trainableWeights)}return i.concat(e)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),r.prototype.loadWeights=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1),n?qe(e,this.layers):Ze(e,this.layers,t)},r.prototype.updatedConfig=function(){var e=this.getConfig();return{className:this.getClassName(),config:e,kerasVersion:"tfjs-layers 0.6.1",backend:"TensorFlow.js"}},r.prototype.toJSON=function(e,t){void 0===t&&(t=!0);var n=_e(this.updatedConfig());return t?JSON.stringify(n):n},r.prototype.call=function(e,n){var i=this;return t.tidy(function(){e=c(e);var t;return t="mask"in n?c(n.mask):o(null,e.length),i.runInternalGraph(e,t)[0]})},r.prototype.computeMask=function(e,n){var i=this;return t.tidy(function(){e=c(e);var t;return t=null==n?o(null,e.length):c(n),i.runInternalGraph(e,t)[1]})},r.prototype.computeOutputShape=function(e){var t=p(e);if(t.length!==this.inputLayers.length)throw new hn("Invalid inputShape argument "+e+": model has "+this.inputLayers.length+" tensor inputs.");for(var n={},i=0;i<t.length;i++){var r=this.inputLayers[i],a=t[i];n[L=r.name+"_0_0"]=a}var o=Object.keys(this.nodesByDepth).map(function(e){return parseInt(e,10)}).sort(w);if(o.length>1)for(var l=0,c=o;l<c.length;l++)for(var h=c[l],d=0,f=this.nodesByDepth[h];d<f.length;d++){var g=f[d],r=g.outboundLayer;if(-1===this.inputLayers.map(function(e){return e.id}).indexOf(r.id)){for(var m=[],y=0;y<g.inboundLayers.length;y++){var v=g.inboundLayers[y],b=g.nodeIndices[y],z=g.tensorIndices[y],I=n[L=v.name+"_"+b+"_"+z];m.push(I)}for(var S=p(r.computeOutputShape(u(m))),N=r.inboundNodes.indexOf(g),y=0;y<S.length;y++)n[L=r.name+"_"+N+"_"+y]=S[y]}}for(var k=[],C=[],i=0;i<this.outputLayers.length;i++){var r=this.outputLayers[i],N=this.outputLayersNodeIndices[i],z=this.outputLayersTensorIndices[i],L=r.name+"_"+N+"_"+z;C.push(L)}for(i=0;i<C.length;i++){var A=C[i];s(A in n),k.push(n[A])}return u(k)},r.prototype.runInternalGraph=function(e,t){null==t&&(t=o(null,e.length));for(var n={},i=0;i<this.inputs.length;++i){var r=this.inputs[i],a=e[i],l=t[i];n[r.id]=[a,l]}for(var u=0,h=Object.keys(this.nodesByDepth).map(function(e){return parseInt(e,10)}).sort(w);u<h.length;u++)for(var p=h[u],d=0,f=this.nodesByDepth[p];d<f.length;d++){for(var g=f[d],m=g.outboundLayer,y=g.inputTensors,v=g.outputTensors,b=new Array,z=0,I=y;z<I.length;z++)(r=I[z]).id in n&&b.push(n[r.id]);if(b.length===y.length){var S={},N=void 0,k=void 0,C=void 0,L=void 0;if(null!=g.callArgs&&(S=g.callArgs),1===b.length){var A=b[0],T=A[0],R=A[1];null==S.mask&&(S.mask=R),C=c(m.call(T,S)),L=c(m.computeMask(T,R)),N=[T],k=[R]}else N=b.map(function(e){return e[0]}),k=b.map(function(e){return e[1]}),null==S.mask&&(S.mask=k),C=c(m.call(N,S)),L=c(m.computeMask(N,k));if(m.activityRegularizer)throw new pn("Model invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(i=0;i<v.length;++i){var r=v[i],a=C[i],l=L[i];n[r.id]=[a,l]}}}for(var D=[],M=[],O=[],F=0,x=this.outputs;F<x.length;F++){s((r=x[F]).id in n,"Could not compute output "+r.name+" : "+r.id);var E=n[r.id],P=E[0],l=E[1];O.push(P.shape),D.push(P),M.push(l)}return[D,M,O]},r.prototype.buildNodeConversionMap=function(e){for(var t,n={},i=0,a=this.layers;i<a.length;i++){var o=a[i];t=o instanceof r?1:0;for(var s=0;s<o.inboundNodes.length;s++){var l=r.nodeKey(o,s);l in this.containerNodes&&(n[l]=t,t+=1)}}return n},r.prototype.getLayer=function(e,t){if(null!=t){if(this.layers.length<=t)throw new hn("Was asked to retrieve layer at index "+t+", but model only has "+this.layers.length+" layer(s).");return this.layers[t]}if(null==e)throw new hn("Provide either a layer name or layer index");for(var n=0,i=this.layers;n<i.length;n++){var r=i[n];if(r.name===e)return r}throw new hn("No such layer: "+e)},r.prototype.calculateLosses=function(){var e=this;return t.tidy(function(){for(var t=[],n=0,i=e.layers;n<i.length;n++)for(var a=i[n],o=0;o<a.inboundNodes.length;++o){var s=r.nodeKey(a,o);e.containerNodes.has(s)&&t.push.apply(t,a.calculateLosses())}return t})},r.prototype.getConfig=function(){for(var e={name:this.name},t=this.buildNodeConversionMap(this.layers),n=[],i=0,a=this.layers;i<a.length;i++){for(var o=(b=a[i]).getClassName(),s=b.getConfig(),l=[],u=0;u<b.inboundNodes.length;u++){var c=b.inboundNodes[u],h=r.nodeKey(b,u),p={};if(this.containerNodes.has(h)&&(c.callArgs&&(-1===JSON.stringify(c.callArgs).indexOf("undefined")?p=c.callArgs:(console.warn("Layer "+b.name+" was passed non-serializable keyword arguments: "+c.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),p={})),c.inboundLayers.length>0)){for(var d=[],f=0;f<c.inboundLayers.length;f++){var g=c.inboundLayers[f],m=c.nodeIndices[f],y=c.tensorIndices[f];null!==(z=t[r.nodeKey(g,m)])&&void 0!==z||(z=0),d.push([g.name,z,y,p])}l.push(d)}}n.push({name:b.name,className:o,config:s,inboundNodes:l})}e.layers=n;for(var v=[],f=0;f<this.inputLayers.length;f++){var b=this.inputLayers[f],m=this.inputLayersNodeIndices[f],h=r.nodeKey(b,m);if(this.containerNodes.has(h)){null!==(z=t[h])&&void 0!==z||(z=0);y=this.inputLayersTensorIndices[f];v.push([b.name,z,y])}}e.inputLayers=v;for(var w=[],f=0;f<this.outputLayers.length;f++){var b=this.outputLayers[f],m=this.outputLayersNodeIndices[f],h=r.nodeKey(b,m);if(this.containerNodes.has(h)){var z=t[h];null!==z&&void 0!==z||(z=0);y=this.outputLayersTensorIndices[f];w.push([b.name,z,y])}}return e.outputLayers=w,e},r.fromConfig=function(e,t){function n(e,t){e.name in r?r[e.name].push(t):r[e.name]=[t]}for(var i={},r={},a=t.name,o=t.layers,l=0,c=o;l<c.length;l++)!function(e){var r=e.name,a=xe(e,null!=t.customObjects?t.customObjects:{});i[r]=a;for(var o=0,s=e.inboundNodes;o<s.length;o++){var l=s[o];if(!(l instanceof Array))throw new hn("Corrupted configuration, expected array for nodeData: "+l);n(a,l)}}(d=c[l]);for(;!S(r);)for(var h=0,p=o;h<p.length;h++){var d=p[h];if((C=i[d.name]).name in r){for(var f=0,g=r[C.name];f<g.length;f++)!function(e,t){for(var r,a=[],o=0,s=t;o<s.length;o++){var l=s[o],c=l[0],h=l[1],p=l[2];if(3===l.length)r={};else{if(4!==l.length)throw new hn("Improperly formatted model config for layer "+JSON.stringify(e)+": "+JSON.stringify(l));r=l[3]}if(!(c in i))return void n(e,t);var d=i[c];if(d.inboundNodes.length<=h)return void n(e,t);var f=d.inboundNodes[h];a.push(f.outputTensors[p])}a.length>0&&e.apply(u(a),r)}(C,g[f]);delete r[C.name]}}for(var m=[],y=[],v=0,b=t.inputLayers;v<b.length;v++){var w=(d=b[v])[0],z=d[1],I=d[2];s(w in i);L=(C=i[w]).inboundNodes[z].outputTensors;m.push(L[I])}for(var N=0,k=t.outputLayers;N<k.length;N++){var w=(d=k[N])[0],z=d[1],I=d[2];s(w in i);var C=i[w],L=C.inboundNodes[z].outputTensors;y.push(L[I])}return new e({inputs:m,outputs:y,name:a})},Object.defineProperty(r.prototype,"stateful",{get:function(){if(this._stateful)throw new hn("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(var e=0,t=this.layers;e<t.length;e++)if(t[e].stateful)return!0;return!1},enumerable:!0,configurable:!0}),i([t.doc({heading:"Layers",subheading:"Classes",namespace:"layers",subclasses:["Model"]})],r.prototype,"getLayer",null),r}(jn),Zn=function(){function e(){this.validationData=null,this.model=null}return e.prototype.setParams=function(e){this.params=e},e.prototype.setModel=function(e){this.model=e},e.prototype.onEpochBegin=function(e,t){return r(this,void 0,void 0,function(){return a(this,function(e){return[2]})})},e.prototype.onEpochEnd=function(e,t){return r(this,void 0,void 0,function(){return a(this,function(e){return[2]})})},e.prototype.onBatchBegin=function(e,t){return r(this,void 0,void 0,function(){return a(this,function(e){return[2]})})},e.prototype.onBatchEnd=function(e,t){return r(this,void 0,void 0,function(){return a(this,function(e){return[2]})})},e.prototype.onTrainBegin=function(e){return r(this,void 0,void 0,function(){return a(this,function(e){return[2]})})},e.prototype.onTrainEnd=function(e){return r(this,void 0,void 0,function(){return a(this,function(e){return[2]})})},e}(),Kn=function(){function e(e,t){void 0===t&&(t=10),null==e&&(e=[]),this.callbacks=e,this.queueLength=t}return e.prototype.append=function(e){this.callbacks.push(e)},e.prototype.setParams=function(e){for(var t=0,n=this.callbacks;t<n.length;t++)n[t].setParams(e)},e.prototype.setModel=function(e){for(var t=0,n=this.callbacks;t<n.length;t++)n[t].setModel(e)},e.prototype.onEpochBegin=function(e,t){return r(this,void 0,void 0,function(){var n,i,r;return a(this,function(a){switch(a.label){case 0:null==t&&(t={}),n=0,i=this.callbacks,a.label=1;case 1:return n<i.length?(r=i[n],[4,r.onEpochBegin(e,t)]):[3,4];case 2:a.sent(),a.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},e.prototype.onEpochEnd=function(e,t){return r(this,void 0,void 0,function(){var n,i,r;return a(this,function(a){switch(a.label){case 0:null==t&&(t={}),n=0,i=this.callbacks,a.label=1;case 1:return n<i.length?(r=i[n],[4,r.onEpochEnd(e,t)]):[3,4];case 2:a.sent(),a.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},e.prototype.onBatchBegin=function(e,t){return r(this,void 0,void 0,function(){var n,i,r;return a(this,function(a){switch(a.label){case 0:null==t&&(t={}),n=0,i=this.callbacks,a.label=1;case 1:return n<i.length?(r=i[n],[4,r.onBatchBegin(e,t)]):[3,4];case 2:a.sent(),a.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},e.prototype.onBatchEnd=function(e,t){return r(this,void 0,void 0,function(){var n,i,r;return a(this,function(a){switch(a.label){case 0:null==t&&(t={}),n=0,i=this.callbacks,a.label=1;case 1:return n<i.length?(r=i[n],[4,r.onBatchEnd(e,t)]):[3,4];case 2:a.sent(),a.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},e.prototype.onTrainBegin=function(e){return r(this,void 0,void 0,function(){var t,n,i;return a(this,function(r){switch(r.label){case 0:null==e&&(e={}),t=0,n=this.callbacks,r.label=1;case 1:return t<n.length?(i=n[t],[4,i.onTrainBegin(e)]):[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},e.prototype.onTrainEnd=function(e){return r(this,void 0,void 0,function(){var t,n,i;return a(this,function(r){switch(r.label){case 0:null==e&&(e={}),t=0,n=this.callbacks,r.label=1;case 1:return t<n.length?(i=n[t],[4,i.onTrainEnd(e)]):[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},e}(),Gn=function(e){function i(){return e.call(this)||this}return n(i,e),i.prototype.onEpochBegin=function(e,t){return r(this,void 0,void 0,function(){return a(this,function(e){return this.seen=0,this.totals={},[2]})})},i.prototype.onBatchEnd=function(e,n){return r(this,void 0,void 0,function(){var e,i,r,o,s=this;return a(this,function(a){null==n&&(n={}),e=null==n.size?0:n.size,this.seen+=e,i=function(i){var a=n[i];"number"==typeof a?(r.totals.hasOwnProperty(i)||(r.totals[i]=0),r.totals[i]=r.totals[i]+a*e):(r.totals.hasOwnProperty(i)||(r.totals[i]=q(0)),t.tidy(function(){s.totals[i]=he(s.totals[i],t.mul(a,q(e))),t.keep(s.totals[i])}))},r=this;for(o in n)i(o);return[2]})})},i.prototype.onEpochEnd=function(e,n){return r(this,void 0,void 0,function(){var e,i,r,o,s,l=this;return a(this,function(a){if(null!=n)for(e=function(e){if(null==i.totals[e])return"continue";"number"==typeof i.totals[e]?n[e]=i.totals[e]/i.seen:t.tidy(function(){n[e]=ce(t.div(q(1),q(l.seen)),l.totals[e]),t.keep(n[e])})},i=this,r=0,o=this.params.metrics;r<o.length;r++)s=o[r],e(s);return[2]})})},i}(Zn),Hn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.onTrainBegin=function(e){return r(this,void 0,void 0,function(){return a(this,function(e){return this.epoch=[],this.history={},[2]})})},t.prototype.onEpochEnd=function(e,t){return r(this,void 0,void 0,function(){var n;return a(this,function(i){null==t&&(t={}),this.epoch.push(e);for(n in t)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(t[n]);return[2]})})},t.prototype.syncData=function(){return r(this,void 0,void 0,function(){var e,t,n,i,r,o,s,l,u;return a(this,function(a){switch(a.label){case 0:e=[],t=[],n=[];for(i in this.history)for(r=this.history[i],o=0;o<r.length;++o)"number"!=typeof r[o]&&(s=r[o],e.push(s.data()),t.push(i),n.push(o));return[4,Promise.all(e)];case 1:for(l=a.sent(),u=0;u<l.length;++u)this.history[t[u]][n[u]].dispose(),this.history[t[u]][n[u]]=l[u][0];return[2]}})})},t}(Zn),Jn=function(e){function t(t){var n=e.call(this)||this;return n.trainBegin=t.onTrainBegin,n.trainEnd=t.onTrainEnd,n.epochBegin=t.onEpochBegin,n.epochEnd=t.onEpochEnd,n.batchBegin=t.onBatchBegin,n.batchEnd=t.onBatchEnd,n}return n(t,e),t.prototype.onEpochBegin=function(e,t){return r(this,void 0,void 0,function(){return a(this,function(n){switch(n.label){case 0:return null==this.epochBegin?[3,3]:[4,Ke(t)];case 1:return n.sent(),[4,this.epochBegin(e,t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},t.prototype.onEpochEnd=function(e,t){return r(this,void 0,void 0,function(){return a(this,function(n){switch(n.label){case 0:return null==this.epochEnd?[3,3]:[4,Ke(t)];case 1:return n.sent(),[4,this.epochEnd(e,t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},t.prototype.onBatchBegin=function(e,t){return r(this,void 0,void 0,function(){return a(this,function(n){switch(n.label){case 0:return null==this.batchBegin?[3,3]:[4,Ke(t)];case 1:return n.sent(),[4,this.batchBegin(e,t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},t.prototype.onBatchEnd=function(e,t){return r(this,void 0,void 0,function(){return a(this,function(n){switch(n.label){case 0:return null==this.batchEnd?[3,3]:[4,Ke(t)];case 1:return n.sent(),[4,this.batchEnd(e,t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},t.prototype.onTrainBegin=function(e){return r(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return null==this.trainBegin?[3,3]:[4,Ke(e)];case 1:return t.sent(),[4,this.trainBegin(e)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},t.prototype.onTrainEnd=function(e){return r(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return null==this.trainEnd?[3,3]:[4,Ke(e)];case 1:return t.sent(),[4,this.trainEnd(e)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},t}(Zn),Xn=Je,$n=Je,Yn=Xe,Qn=Xe,ei=$e,ti=$e,ni=it,ii=lt,ri=rt,ai=function(){function e(t){if(this.id2Value={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n];else{if(null==t)return;for(var i=0,r=t;i<r.length;i++){var a=r[i];this.add(a.key,a.value)}}}return e.prototype.add=function(e,t){if(mt(e,t),null!=this.id2Value[e.id])throw new hn("Duplicate key: name="+e.name+", id="+e.id);return this.id2Value[e.id]=t,this},e.prototype.addFeed=function(e){this.add(e.key,e.value)},e.prototype.hasKey=function(e){return null!=this.id2Value[e.id]},e.prototype.getValue=function(e){if(null==this.id2Value[e.id])throw new hn("Nonexistent key: "+JSON.stringify(e));return this.id2Value[e.id]},e}();!function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(Vn||(Vn={}));var oi=function(e){function o(t){return e.call(this,t)||this}return n(o,e),o.prototype.compile=function(e){var n=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer=gt(e.optimizer);else{if(!(e.optimizer instanceof t.Optimizer))throw new hn("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer=e.optimizer}var i=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new hn("When passing an Array as loss, it should have one entry per model output. The model has "+this.outputs.length+" output(s), but you passed loss="+e.loss+".");var r=e.loss;i=r.map(function(e){return ut(e)})}else{var a=ut(e.loss);this.outputs.map(function(e){i.push(a)})}else{e.loss=e.loss;for(var o in e.loss)if(-1===this.outputNames.indexOf(o))throw new hn('Unknown entry in loss dictionary: "'+o+'". Only expect the following keys: '+this.outputNames);for(var s in this.outputNames)null==e.loss[s]&&console.warn('Output "'+s+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to '+s+" during training"),i.push(ut(e.loss[s]))}this.lossFunctions=i,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var l=0;l<this.outputs.length;++l){var u=this.internalOutputShapes[l],c=this.outputNames[l];this.feedOutputNames.push(c),this.feedOutputShapes.push(u),this.feedLossFns.push(this.lossFunctions[l])}var h=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Ie("loss",function(){for(var e=0;e<n.outputs.length;++e)if(-1===h.indexOf(e)){var t=n.lossFunctions[e];n.outputs.length>1&&(n.metricsTensors.push([t,e]),n.metricsNames.push(n.outputNames[e]+"_loss"))}});var p=Rt(e.metrics,this.outputNames),d=function(e,t,i){n.outputNames.length>1&&(t=n.outputNames[e]+"_"+t),n.metricsNames.push(t),n.metricsTensors.push([i,e])};Ie("metric",function(){for(var e=0;e<n.outputs.length;++e)!function(e){if(-1!==h.indexOf(e))return"continue";!function(t){for(var i,r,a,o=0,s=p[e];o<s.length;o++)!function(t){if(-1!==["accuracy","acc","crossentropy","ce"].indexOf(t)){var o=n.internalOutputShapes[e];1===o[o.length-1]||n.lossFunctions[e]===at?-1!==["accuracy","acc"].indexOf(t)?r=ct:-1!==["crossentropy","ce"].indexOf(t)&&(r=pt):n.lossFunctions[e]===rt?-1!==["accuracy","acc"].indexOf(t)?r=dt:-1!==["crossentropy","ce"].indexOf(t)&&(r=ri):-1!==["accuracy","acc"].indexOf(t)?r=ht:-1!==["crossentropy","ce"].indexOf(t)&&(r=ni);var s=void 0;-1!==["accuracy","acc"].indexOf(t)?s="acc":-1!==["crossentropy","ce"].indexOf(t)&&(s="ce"),a=r,i=""+s}else{var l=ft(t);a=l,i=""+t}var u;Ie(i,function(){u=a}),d(e,i,u)}(s[o])}()}(e)}),this.collectedTrainableWeights=this.trainableWeights},o.prototype.checkTrainableWeightsConsistency=function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},o.prototype.evaluate=function(e,t,n){void 0===n&&(n={});var i=null==n.batchSize?32:n.batchSize,r=this.standardizeUserData(e,t,!0,i),a=r[0].concat(r[1]);this.makeTestFunction();var o=this.testFunction;return u(this.testLoop(o,a,i,n.verbose,n.steps))},o.prototype.checkNumSamples=function(e,t,n,i){void 0===i&&(i="steps");var r;if(null!=n){if(r=null,null!=t)throw new hn("If "+i+" is set, batchSize must be null or undefined.Got batchSize = "+t)}else{if(null==e)throw new hn("Either the input data should have a defined shape, or "+i+" shoud be specified.");r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r},o.prototype.predictLoop=function(e,n,i){var r=this;void 0===n&&(n=32),void 0===i&&(i=!1);var a=this.checkNumSamples(e);if(i)throw new pn("Verbose predictLoop() is not implemented yet.");for(var o=Ct(a,n),s=[],l=0;l<o.length;++l)!function(n){var i=t.tidy(function(){var t=o[n][0],i=o[n][1],a=Lt(e,t,i),s=[];if(Array.isArray(a))for(var l=0;l<a.length;++l)s.push({key:r.inputs[l],value:a[l]});else s.push({key:r.inputs[0],value:a});var u=new ai(s);return yt(r.outputs,u)});if(0===n)for(var a=0,l=i;a<l.length;a++){var u=l[a];s.push(u)}else for(var c=0;c<i.length;++c)s[c]=se(s[c],i[c])}(l);return u(s)},o.prototype.predict=function(e,t){void 0===t&&(t={}),Tt(e,this.inputNames,this.feedInputShapes,!1);var n=null==t.batchSize?32:t.batchSize;return this.predictLoop(e,n)},o.prototype.predictOnBatch=function(e){return Tt(e,this.inputNames,this.feedInputShapes,!0),this.predictLoop(e,e.shape[0])},o.prototype.standardizeUserData=function(e,t,n,i){if(void 0===n&&(n=!0),null==this.optimizer)throw new cn("You must compile a model before training/testing. Use Model.compile(modelCompileConfig).");for(var r=[],a=0;a<this.feedOutputShapes.length;++a){var o=this.feedOutputShapes[a];this.feedLossFns[a]===rt?r.push(o.slice(0,o.length-1).concat([1])):r.push(o)}if(e=St(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=St(t,this.feedOutputNames,r,!1,"target"),Nt(e,t),kt(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=i&&i>0&&e[0].shape[0]%i!=0)throw new hn("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+i+". Found: "+e[0].shape[0]+" sample(s).");return[e,t,null]},o.prototype.fitLoop=function(e,n,i,o,s,l,u,c,h,p,d,f,g,m){return void 0===f&&(f=0),r(this,void 0,void 0,function(){var r,y,v,b,w,z,I=this;return a(this,function(S){switch(S.label){case 0:if(null==o&&(o=32),null==s&&(s=1),null==p&&(p=!0),null==f&&(f=0),r=!1,null!=c&&null!=h&&(r=!0),null!=m&&(r=!0,null==g))throw new hn("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");if(null!=(y=this.checkNumSamples(n,o,g,"steps_per_epoch"))&&(v=_(0,y)),this.history=new Hn,u=null==u?[new Gn]:[new Gn].concat(u),u=u.concat([this.history]),l>0)throw new pn("Verbose mode is not implemented yet.");return(b=new Kn(u)).setModel(this),b.setParams({epochs:s,steps:g,verbose:l,doValidation:r,metrics:d}),[4,b.onTrainBegin()];case 1:S.sent(),w=function(s){var l,u,d,f,m;return a(this,function(w){switch(w.label){case 0:return[4,b.onEpochBegin(s)];case 1:if(w.sent(),l={},null==g)return[3,2];throw new pn("stepsPerEpoch mode is not implemented yet.");case 2:if("batch"===p)throw new pn("batch shuffling is not implemneted yet");p&&t.util.shuffle(v),u=t.tensor1d(v),d=Ct(y,o),f=function(s){var p;return a(this,function(a){switch(a.label){case 0:return p={},[4,b.onBatchBegin(s,p)];case 1:return a.sent(),t.tidy(function(){var a=d[s][0],f=d[s][1],g=ee(u,a,f-a);p.batch=s,p.size=f-a;for(var m=At(n,g),y=e(m),v=0;v<i.length;++v){var b=i[v],w=y[v];p[b]=w,t.keep(w)}if(s===d.length-1&&r)for(var z=I.testLoop(c,h,o),v=0;v<i.length;++v){var b=i[v],w=z[v];t.keep(w),l["val_"+b]=w}}),[4,b.onBatchEnd(s,p)];case 2:return a.sent(),Ge(p),[2]}})},m=0,w.label=3;case 3:return m<d.length?[5,f(m)]:[3,6];case 4:w.sent(),w.label=5;case 5:return++m,[3,3];case 6:u.dispose(),w.label=7;case 7:return[4,b.onEpochEnd(s,l)];case 8:return w.sent(),[2]}})},z=f,S.label=2;case 2:return z<s?[5,w(z)]:[3,5];case 3:S.sent(),S.label=4;case 4:return++z,[3,2];case 5:return[4,b.onTrainEnd()];case 6:return S.sent(),[4,this.history.syncData()];case 7:return S.sent(),[2,this.history]}})})},o.prototype.testLoop=function(e,n,i,r,a){void 0===r&&(r=0);var o=this.checkNumSamples(n,i,a,"steps"),s=[];if(1===r)throw new pn("Verbose mode is not implemented yet.");if(null!=a)throw new pn("steps mode in testLoop() is not implemented yet");for(var l=Ct(o,i),u=t.tensor1d(_(0,o)),c=0;c<l.length;++c){var h=l[c][0],p=l[c][1],d=e(At(n,ee(u,h,p-h)));if(0===c)for(g=0;g<d.length;++g)s.push(q(0));for(g=0;g<d.length;++g){var f=d[g];s[g]=t.add(s[g],ce(q(p-h),f))}}for(var g=0;g<s.length;++g)s[g]=t.div(s[g],q(o));return s},o.prototype.getDedupedMetricsNames=function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var i=e[n],r=i;l(e,i)>1&&(r+="_"+l(e.slice(0,n),i)),t.push(r)}return t},o.prototype.makeTestFunction=function(){var e=this;this.testFunction=function(n){return t.tidy(function(){for(var i,r=[],a=n.slice(0,e.inputs.length),o=n.slice(e.inputs.length,e.inputs.length+e.outputs.length),s=[],l=0;l<e.inputs.length;++l)s.push({key:e.inputs[l],value:a[l]});for(var u=new ai(s),c=yt(e.outputs,u),l=0;l<e.lossFunctions.length;++l){var h=e.lossFunctions[l],p=t.mean(h(o[l],c[l]));i=0===l?p:t.add(i,p),r.push(i)}for(l=0;l<e.metricsTensors.length;++l){var d=e.metricsTensors[l][0],f=e.metricsTensors[l][1],g=t.mean(d(o[f],c[f]));r.push(g)}return r})}},o.prototype.fit=function(e,n,i){return void 0===i&&(i={}),r(this,void 0,void 0,function(){var r,o,s,l,u,c,h,p,d,f,g,m,y,v,b,w,z,I=this;return a(this,function(a){if(r=null==i.batchSize?32:i.batchSize,o=this.standardizeUserData(e,n,!1,r),s=o[0],l=o[1],u=!1,null!=i.validationData&&i.validationData.length>0){if(u=!0,2!==i.validationData.length)throw 3===i.validationData.length?new pn("validationData including sample weights is not supported yet."):new hn("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+i.validationData+" is invalid.");c=i.validationData[0],h=i.validationData[1],d=this.standardizeUserData(c,h,!0,r),c=d[0],h=d[1],p=c.concat(h)}else null!=i.validationSplit&&i.validationSplit>0&&i.validationSplit<1?(u=!0,f=Math.floor(s[0].shape[0]*(1-i.validationSplit)),g=s[0].shape[0],c=Lt(s,f,g),s=Lt(s,0,f),h=Lt(l,f,g),l=Lt(l,0,f),p=c.concat(h)):null!=i.validationSteps&&(u=!0);return m=s.concat(l),this.checkTrainableWeightsConsistency(),y=function(e){var n=e.slice(0,I.inputs.length),i=e.slice(I.inputs.length,I.inputs.length+I.outputs.length),r=[],a=I.collectedTrainableWeights.map(function(e){return e.read()});return[I.optimizer.minimize(function(){for(var e=[],a=0;a<I.inputs.length;++a)e.push({key:I.inputs[a],value:n[a]});for(var o,s=new ai(e),l=yt(I.outputs,s,{training:!0}),a=0;a<I.lossFunctions.length;++a){var u=(0,I.lossFunctions[a])(i[a],l[a]);t.mean(u),o=0===a?u:t.add(o,u)}for(a=0;a<I.metricsTensors.length;++a){var c=I.metricsTensors[a][0],h=I.metricsTensors[a][1],p=t.mean(c(i[h],l[h]));t.keep(p),r.push(p)}return o=t.mean(o),I.calculateLosses().forEach(function(e){o=t.add(o,e)}),o},!0,a)].concat(r)},v=this.getDedupedMetricsNames(),u?(this.makeTestFunction(),b=this.testFunction,w=v.slice().concat(v.map(function(e){return"val_"+e}))):(b=null,p=[],w=v.slice()),z=He(i.callbacks),[2,this.fitLoop(y,m,v,r,i.epochs,i.verbose,z,b,p,i.shuffle,w,null,null,null)]})})},o.prototype.getNamedWeights=function(e){for(var t={},n=null!=e&&e.trainableOnly,i=n?this.trainableWeights:this.weights,r=this.getWeights(n),a=0;a<i.length;++a)n&&!i[a].trainable||(t[i[a].originalName]=r[a]);return t},o.prototype.save=function(e,n){return r(this,void 0,void 0,function(){var i,r,o,s,l;return a(this,function(a){switch(a.label){case 0:if("string"==typeof e){if(0===(i=t.io.getSaveHandlers(e)).length)throw new hn("Cannot find any save handlers for URL '"+e+"'");if(i.length>1)throw new hn("Found more than one ("+i.length+") save handlers for URL '"+e+"'");e=i[0]}if(null==e.save)throw new hn("Model.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,t.io.encodeWeights(this.getNamedWeights(n))];case 1:return r=a.sent(),o=!1,s=null,l=this.toJSON(s,o),[2,e.save({modelTopology:l,weightData:r.data,weightSpecs:r.specs})]}})})},o.className="Model",i([t.doc({heading:"Models",subheading:"Classes",configParamIndices:[0]})],o.prototype,"compile",null),i([t.doc({heading:"Models",subheading:"Classes",configParamIndices:[2]})],o.prototype,"evaluate",null),i([t.doc({heading:"Models",subheading:"Classes",configParamIndices:[1]})],o.prototype,"predict",null),i([t.doc({heading:"Models",subheading:"Classes"})],o.prototype,"predictOnBatch",null),i([t.doc({heading:"Models",subheading:"Classes",configParamIndices:[2]})],o.prototype,"fit",null),o=i([t.doc({heading:"Models",subheading:"Classes"})],o)}(qn);t.serialization.SerializationMap.register(oi);var si=["fanIn","fanOut","fanAvg"],li=["normal","uniform"],ui=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return n(r,e),r.prototype.fromConfigUsesCustomObjects=function(){return!1},r.prototype.getConfig=function(){return{}},r=i([t.doc({heading:"Initializers",subheading:"Classes",namespace:"initializers"})],r)}(t.serialization.Serializable),ci=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return n(i,e),i.prototype.apply=function(e,n){return t.zeros(e,n)},i.className="Zeros",i}(ui);t.serialization.SerializationMap.register(ci);var hi=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return n(i,e),i.prototype.apply=function(e,n){return t.ones(e,n)},i.className="Ones",i}(ui);t.serialization.SerializationMap.register(hi);var pi=function(e){function i(t){var n=e.call(this)||this;return n.value=t.value,n}return n(i,e),i.prototype.apply=function(e,n){var i=this;return t.tidy(function(){return ce(t.scalar(i.value),t.ones(e,n))})},i.prototype.getConfig=function(){return{value:this.value}},i.className="Constant",i}(ui);t.serialization.SerializationMap.register(pi);var di=function(e){function i(t){var n=e.call(this)||this;return n.DEFAULT_MINVAL=-.05,n.DEFAULT_MAXVAL=.05,n.minval=t.minval||n.DEFAULT_MINVAL,n.maxval=t.maxval||n.DEFAULT_MAXVAL,n.seed=t.seed,n}return n(i,e),i.prototype.apply=function(e,n){return t.randomUniform(e,this.minval,this.maxval,n)},i.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},i.className="RandomUniform",i}(ui);t.serialization.SerializationMap.register(di);var fi=function(e){function t(t){var n=e.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return n(t,e),t.prototype.apply=function(e,t){if("bool"===t)throw new pn("randomNormal does not support dType bool.");return pe(e,this.mean,this.stddev,t,this.seed)},t.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},t.className="RandomNormal",t}(ui);t.serialization.SerializationMap.register(fi);var gi=function(e){function i(t){var n=e.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return n(i,e),i.prototype.apply=function(e,n){if("bool"===n)throw new pn("truncatedNormal does not support dType bool.");return t.truncatedNormal(e,this.mean,this.stddev,n,this.seed)},i.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},i.className="TruncatedNormal",i}(ui);t.serialization.SerializationMap.register(gi);var mi=function(e){function i(n){var i=e.call(this)||this;return i.gain=null!=n.gain?t.scalar(n.gain):q(1),i}return n(i,e),i.prototype.apply=function(e,n){var i=this;return t.tidy(function(){if(2!==e.length||e[0]!==e[1])throw new hn("Identity matrix initializer can only be used for 2D square matrices.");return ce(i.gain,t.eye(e[0]))})},i.prototype.getConfig=function(){return{gain:this.gain.get()}},i.className="Identity",i}(ui);t.serialization.SerializationMap.register(mi);var yi=function(e){function i(t){var n=e.call(this)||this;if(t.scale<0)throw new hn("scale must be a positive float. Got: "+t.scale);return n.scale=null==t.scale?1:t.scale,n.mode=t.mode,Dt(n.mode),n.distribution=t.distribution,Mt(n.distribution),n.seed=t.seed,n}return n(i,e),i.prototype.apply=function(e,n){var i=Ot(e),r=i[0],a=i[1],o=this.scale;if("fanIn"===this.mode?o/=Math.max(1,r):"fanOut"===this.mode?o/=Math.max(1,a):o/=Math.max(1,(r+a)/2),"normal"===this.distribution){var s=Math.sqrt(o);if("bool"===n)throw new pn(this.getClassName()+" does not support dType bool.");return t.truncatedNormal(e,0,s,n,this.seed)}var l=Math.sqrt(3*o);return t.randomUniform(e,-l,l,n)},i.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},i.className="VarianceScaling",i}(ui);t.serialization.SerializationMap.register(yi);var vi=function(e){function t(t){return e.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==t?null:t.seed})||this}return n(t,e),t.prototype.getClassName=function(){return yi.className},t}(yi),bi=function(e){function t(t){return e.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==t?null:t.seed})||this}return n(t,e),t.prototype.getClassName=function(){return yi.className},t}(yi),wi=function(e){function t(t){return e.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})||this}return n(t,e),t.prototype.getClassName=function(){return yi.className},t}(yi),zi=function(e){function t(t){return e.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})||this}return n(t,e),t.prototype.getClassName=function(){return yi.className},t}(yi),Ii=function(e){function i(t){var n=e.call(this)||this;if(n.DEFAULT_GAIN=1,n.gain=null==t.gain?n.DEFAULT_GAIN:t.gain,n.seed=t.seed,null!=n.seed)throw new pn("Random seed is not implemented for Orthogonal Initializer yet.");return n}return n(i,e),i.prototype.apply=function(e,n){var i=this;return t.tidy(function(){if(2!==e.length)throw new pn("The Orthogonal Initializer does not support non-2D shapes yet.");e[0]*e[1]>2e3&&console.warn("Orthgonal initializer is being called on a matrix with more  than 2000 ("+e[0]*e[1]+") elements: Slowness may result.");var n=pe(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32"),r=t.linalg.gramSchmidt(n);return e[0]>e[1]&&(r=r.transpose()),ce(q(i.gain),r)})},i.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},i.className="Orthogonal",i}(ui);t.serialization.SerializationMap.register(Ii);var Si={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",identity:"Identity",leCunNormal:"LeCunNormal",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"},Ni=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getConfig=function(){return{}},t}(t.serialization.Serializable),ki=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.apply=function(e,t){return void 0===t&&(t=1),ve(e,t)},t.className="elu",t}(Ni);t.serialization.SerializationMap.register(ki);var Ci=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return n(i,e),i.prototype.apply=function(e){return t.selu(e)},i.className="selu",i}(Ni);t.serialization.SerializationMap.register(Ci);var Li=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return n(i,e),i.prototype.apply=function(e){return t.relu(e)},i.className="relu",i}(Ni);t.serialization.SerializationMap.register(Li);var Ai=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return n(i,e),i.prototype.apply=function(e){return t.tidy(function(){return t.minimum(t.scalar(6),t.relu(e))})},i.className="relu6",i}(Ni);t.serialization.SerializationMap.register(Ai);var Ti=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.apply=function(e){return e},t.className="linear",t}(Ni);t.serialization.SerializationMap.register(Ti);var Ri=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return n(i,e),i.prototype.apply=function(e){return t.sigmoid(e)},i.className="sigmoid",i}(Ni);t.serialization.SerializationMap.register(Ri);var Di=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.apply=function(e){return Te(e)},t.className="hardSigmoid",t}(Ni);t.serialization.SerializationMap.register(Di);var Mi=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return n(i,e),i.prototype.apply=function(e){return t.softplus(e)},i.className="softplus",i}(Ni);t.serialization.SerializationMap.register(Mi);var Oi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.apply=function(e){return be(e)},t.className="softsign",t}(Ni);t.serialization.SerializationMap.register(Oi);var Fi=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return n(i,e),i.prototype.apply=function(e){return t.tanh(e)},i.className="tanh",i}(Ni);t.serialization.SerializationMap.register(Fi);var xi=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return n(i,e),i.prototype.apply=function(e,n){return void 0===n&&(n=-1),t.softmax(e,n)},i.className="softmax",i}(Ni);t.serialization.SerializationMap.register(xi);var Ei=function(e){function i(t){var n=e.call(this,null==t?{}:t)||this;return n.DEFAULT_ALPHA=.3,null==t&&(t={}),n.alpha=null==t.alpha?n.DEFAULT_ALPHA:t.alpha,n}return n(i,e),i.prototype.call=function(e,n){var i=y(e);return t.leakyRelu(i,this.alpha)},i.prototype.computeOutputShape=function(e){return e},i.prototype.getConfig=function(){var t={alpha:this.alpha},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},i.className="LeakyReLU",i}(jn);t.serialization.SerializationMap.register(Ei);var Pi=function(e){function i(t){var n=e.call(this,null==t?{}:t)||this;if(n.DEFAULT_ALPHA=1,null==t&&(t={}),null!=t.alpha&&t.alpha!==n.DEFAULT_ALPHA)throw new pn("Non-default alpha value ("+t.alpha+") is not supported by the ELU layer yet.");return n.alpha=null==t.alpha?n.DEFAULT_ALPHA:t.alpha,n}return n(i,e),i.prototype.call=function(e,n){var i=y(e);return t.elu(i)},i.prototype.computeOutputShape=function(e){return e},i.prototype.getConfig=function(){var t={alpha:this.alpha},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},i.className="ELU",i}(jn);t.serialization.SerializationMap.register(Pi);var _i=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;return n.DEFAULT_THETA=1,null==t&&(t={}),n.theta=null==t.theta?n.DEFAULT_THETA:t.theta,n.thetaTensor=q(n.theta),n}return n(t,e),t.prototype.call=function(e,t){var n=y(e);return n.mul(J(n.greater(this.thetaTensor),"float32"))},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t={theta:this.theta},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="ThresholdedReLU",t}(jn);t.serialization.SerializationMap.register(_i);var Bi=function(e){function t(t){var n=e.call(this,null==t?{}:t)||this;return n.DEFAULT_AXIS=1,null==t&&(t={}),n.softmax=(new xi).apply,n.axis=null==t.axis?n.DEFAULT_AXIS:t.axis,n}return n(t,e),t.prototype.call=function(e,t){var n=y(e);return this.softmax(n,this.axis)},t.prototype.computeOutputShape=function(e){return e},t.prototype.getConfig=function(){var t={axis:this.axis},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.className="Softmax",t}(jn);t.serialization.SerializationMap.register(Bi);var Ui=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(t.serialization.Serializable),ji=function(e){function r(t){var n=e.call(this)||this,i=null==t||null==t.l1?.01:t.l1,r=null==t||null==t.l2?.01:t.l2;return n.hasL1=0!==i,n.hasL2=0!==r,n.l1=q(i),n.l2=q(r),n}return n(r,e),r.prototype.apply=function(e){var n=this;return t.tidy(function(){var i=t.zeros([1]);return n.hasL1&&(i=t.add(i,t.sum(ce(n.l1,t.abs(e))))),n.hasL2&&(i=t.add(i,t.sum(ce(n.l2,ge(e))))),i.asScalar()})},r.prototype.getConfig=function(){return{l1:this.l1.dataSync()[0],l2:this.l2.dataSync()[0]}},r.fromConfig=function(e,t){return new e({l1:t.l1,l2:t.l2})},r.className="L1L2",r=i([t.doc({heading:"Regularizers",namespace:"regularizers"})],r)}(Ui);t.serialization.SerializationMap.register(ji);var Wi={l1l2:"L1L2"},Vi=function(e){function i(t,n){var i=e.call(this,n)||this;if(i.kernel=null,i.bias=null,i.DEFAULT_KERNEL_INITIALIZER="glorotNormal",i.DEFAULT_BIAS_INITIALIZER="zeros",i.rank=t,1!==i.rank&&2!==i.rank)throw new pn("Convolution layer for rank other than 1 or 2 ("+i.rank+") is not implemented yet.");if(i.filters=n.filters,i.kernelSize=Zt(n.kernelSize,t,"kernelSize"),i.strides=Zt(null==n.strides?1:n.strides,t,"strides"),i.padding=null==n.padding?"valid":n.padding,C(i.padding),i.dataFormat=null==n.dataFormat?"channelsLast":n.dataFormat,k(i.dataFormat),i.dilationRate=null==n.dilationRate?1:n.dilationRate,1===i.rank&&Array.isArray(i.dilationRate)&&1!==i.dilationRate.length)throw new hn("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(i.dilationRate));if(2===i.rank)if("number"==typeof i.dilationRate)i.dilationRate=[i.dilationRate,i.dilationRate];else if(2!==i.dilationRate.length)throw new hn("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(i.dilationRate));return i.activation=Bt(n.activation),i.useBias=null==n.useBias||n.useBias,i.kernelInitializer=Et(n.kernelInitializer||i.DEFAULT_KERNEL_INITIALIZER),i.biasInitializer=Et(n.biasInitializer||i.DEFAULT_BIAS_INITIALIZER),i.kernelConstraint=Fe(n.kernelConstraint),i.biasConstraint=Fe(n.biasConstraint),i.kernelRegularizer=qt(n.kernelRegularizer),i.biasRegularizer=qt(n.biasRegularizer),i.activityRegularizer=qt(n.activityRegularizer),i}return n(i,e),i.prototype.build=function(e){e=v(e);var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new hn("The channel dimension of the input should be defined. Found "+e[t]);var n=e[t],i=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(r={},r[t]=n,r)}],this.built=!0;var r},i.prototype.call=function(e,n){var i=this;return t.tidy(function(){e=y(e);var t,n=null==i.bias?null:i.bias.read();if(1===i.rank)t=Jt(e,i.kernel.read(),n,i.strides[0],i.padding,i.dataFormat,i.dilationRate);else if(2===i.rank)t=Xt(e,i.kernel.read(),n,i.strides,i.padding,i.dataFormat,i.dilationRate);else if(3===i.rank)throw new pn("3D convolution is not implemented yet.");return null!=i.activation&&(t=i.activation.apply(t)),t})},i.prototype.computeOutputShape=function(e){e=v(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),i=0;i<n.length;++i){var r=Kt(n[i],this.kernelSize[i],this.padding,this.strides[i],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[i]);t.push(r)}var a=[e[0]];return"channelsLast"===this.dataFormat?(a=a.concat(t)).push(this.filters):(a.push(this.filters),a=a.concat(t)),a},i.prototype.getConfig=function(){var t={rank:this.rank,filters:this.filters,kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Pt(this.activation),useBias:this.useBias,kernelInitializer:xt(this.kernelInitializer),biasInitializer:xt(this.biasInitializer),kernelRegularizer:Wt(this.kernelRegularizer),biasRegularizer:Wt(this.biasRegularizer),activityRegularizer:Wt(this.activityRegularizer),kernelConstraint:Me(this.kernelConstraint),biasConstraint:Me(this.biasConstraint)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},i}(jn),qi=function(e){function t(t){return e.call(this,2,t)||this}return n(t,e),t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.rank,t},t.className="Conv2D",t}(Vi);t.serialization.SerializationMap.register(qi);var Zi=function(e){function i(t){var n=e.call(this,t)||this;if(n.inputSpec=[new Pn({ndim:4})],"same"!==n.padding&&"valid"!==n.padding)throw new hn("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+n.padding);return n}return n(i,e),i.prototype.build=function(e){if(4!==(e=v(e)).length)throw new hn("Input should have rank 4; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new hn("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],i=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Pn({ndim:4,axes:(r={},r[t]=n,r)})],this.built=!0;var r},i.prototype.call=function(e,n){var i=this;return t.tidy(function(){var n=y(e);if(4!==n.shape.length)throw new hn("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+n.shape.length);var r,a,o=n.shape,s=o[0];"channelsFirst"===i.dataFormat?(r=2,a=3):(r=1,a=2);var l=o[r],u=o[a],c=i.kernelSize[0],h=i.kernelSize[1],p=i.strides[0],d=i.strides[1],f=[s,Gt(l,p,c,i.padding),Gt(u,d,h,i.padding),i.filters];"channelsLast"!==i.dataFormat&&(n=t.transpose(n,[0,2,3,1]));var g=t.conv2dTranspose(n,i.kernel.read(),f,i.strides,i.padding);return"channelsLast"!==i.dataFormat&&(g=t.transpose(g,[0,3,1,2])),null!=i.bias&&(g=ye(g,i.bias.read(),i.dataFormat)),null!=i.activation&&(g=i.activation.apply(g)),g})},i.prototype.computeOutputShape=function(e){var t,n,i,r=(e=v(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,i=3):(t=3,n=1,i=2);var a=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],l=this.strides[1];return r[t]=this.filters,r[n]=Gt(r[n],s,a,this.padding),r[i]=Gt(r[i],l,o,this.padding),r},i.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.dilationRate,t},i.className="Conv2DTranspose",i}(qi);t.serialization.SerializationMap.register(Zi);var Ki=function(e){function t(t){return e.call(this,2,t)||this}return n(t,e),t.className="SeparableConv2D",t}(function(e){function i(t,n){var i=e.call(this,t,n)||this;if(i.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",i.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",i.depthwiseKernel=null,i.pointwiseKernel=null,null==n.filters)throw new hn("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=n.kernelInitializer||null!=n.kernelRegularizer||null!=n.kernelConstraint)throw new hn("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=n.padding&&"same"!==n.padding&&"valid"!==n.padding)throw new hn("SeparableConv"+i.rank+"D supports only padding modes: 'same' and 'valid', but received "+JSON.stringify(n.padding));return i.depthMultiplier=null==n.depthMultiplier?1:n.depthMultiplier,i.depthwiseInitializer=Et(n.depthwiseInitializer||i.DEFAULT_DEPTHWISE_INITIALIZER),i.depthwiseRegularizer=qt(n.depthwiseRegularizer),i.depthwiseConstraint=Fe(n.depthwiseConstraint),i.pointwiseInitializer=Et(n.depthwiseInitializer||i.DEFAULT_POINTWISE_INITIALIZER),i.pointwiseRegularizer=qt(n.pointwiseRegularizer),i.pointwiseConstraint=Fe(n.pointwiseConstraint),i}return n(i,e),i.prototype.build=function(e){if((e=v(e)).length<this.rank+2)throw new hn("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2)+", but received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new hn("The channel dimension of the inputs should be defined, but found "+JSON.stringify(e[t]));for(var n=e[t],i=this.kernelSize.concat([n,this.depthMultiplier]),r=[],a=0;a<this.rank;++a)r.push(1);r.push(n*this.depthMultiplier,this.filters);this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",r,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.inputSpec=[new Pn({ndim:this.rank+2,axes:(o={},o[t]=n,o)})],this.built=!0;var o},i.prototype.call=function(e,n){var i=this;return t.tidy(function(){e=y(e);var n;if(1===i.rank)throw new pn("1D separable convolution is not implemented yet.");return 2===i.rank&&("channelsFirst"===i.dataFormat&&(e=t.transpose(e,[0,2,3,1])),n=t.separableConv2d(e,i.depthwiseKernel.read(),i.pointwiseKernel.read(),i.strides,i.padding,i.dilationRate,"NHWC")),i.useBias&&(n=ye(n,i.bias.read(),i.dataFormat)),null!=i.activation&&(n=i.activation.apply(n)),"channelsFirst"===i.dataFormat&&(n=t.transpose(n,[0,3,1,2])),n})},i.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=xt(this.depthwiseInitializer),t.pointwiseInitializer=xt(this.pointwiseInitializer),t.depthwiseRegularizer=Wt(this.depthwiseRegularizer),t.pointwiseRegularizer=Wt(this.pointwiseRegularizer),t.depthwiseConstraint=Me(this.depthwiseConstraint),t.pointwiseConstraint=Me(this.pointwiseConstraint),t},i.className="SeparableConv",i}(Vi));t.serialization.SerializationMap.register(Ki);var Gi=function(e){function t(t){var n=e.call(this,1,t)||this;return n.inputSpec=[{ndim:3}],n}return n(t,e),t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this);return delete t.rank,delete t.dataFormat,t},t.className="Conv1D",t}(Vi);t.serialization.SerializationMap.register(Gi);var Hi=function(e){function i(t){var n=e.call(this,t)||this;return"number"==typeof t.cropping?n.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:"number"==typeof t.cropping[0]?n.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:n.cropping=t.cropping,n.dataFormat=void 0===t.dataFormat?"channelsLast":t.dataFormat,n.inputSpec=[{ndim:4}],n}return n(i,e),i.prototype.computeOutputShape=function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]},i.prototype.call=function(e,n){var i=this;return t.tidy(function(){if(e=y(e),"channelsLast"===i.dataFormat)return ne(t=ne(e,i.cropping[0][0],e.shape[1]-i.cropping[0][0]-i.cropping[0][1],2),i.cropping[1][0],e.shape[2]-i.cropping[1][1]-i.cropping[1][0],3);var t=ne(e,i.cropping[0][0],e.shape[2]-i.cropping[0][0]-i.cropping[0][1],3);return ne(t,i.cropping[1][0],e.shape[3]-i.cropping[1][1]-i.cropping[1][0],4)})},i.prototype.getConfig=function(){var t={cropping:this.cropping,dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},i.className="Cropping2D",i}(jn);t.serialization.SerializationMap.register(Hi);var Ji=function(e){function i(t){var n=e.call(this,t)||this;return n.depthwiseKernel=null,n.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,n.depthwiseInitializer=Et(t.depthwiseInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.depthwiseConstraint=Fe(t.depthwiseConstraint),n.depthwiseRegularizer=qt(t.depthwiseRegularizer),n}return n(i,e),i.prototype.build=function(e){if((e=v(e)).length<4)throw new hn("Inputs to DepthwiseConv2D should have rank 4. Received input shape: "+JSON.stringify(e)+".");var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new hn("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not ("+e[t]+").");var n=e[t],i=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},i.prototype.call=function(e,n){var i=this;return t.tidy(function(){var t=$t(e=y(e),i.depthwiseKernel.read(),i.strides,i.padding,i.dataFormat,null);return i.useBias&&(t=ye(t,i.bias.read(),i.dataFormat)),null!=i.activation&&(t=i.activation.apply(t)),t})},i.prototype.computeOutputShape=function(e){e=v(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],i="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,r=Kt(t,this.kernelSize[0],this.padding,this.strides[0]),a=Kt(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],i,r,a]:[e[0],r,a,i]},i.className="DepthwiseConv2D",i}(qi);t.serialization.SerializationMap.register(Ji);var Xi=function(e){function i(t){var n=e.call(this,t)||this;if(n.rate=Math.max(Math.min(t.rate,1),0),n.rateScalar=q(n.rate),n.noiseShape=t.noiseShape,n.seed=t.seed,null!=n.seed)throw new pn("Non-default seed is not implemented in Dropout layer yet: "+n.seed);return n.supportsMasking=!0,n}return n(i,e),i.prototype.getNoiseShape=function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],i=0;i<this.noiseShape.length;++i)n.push(null==this.noiseShape[i]?t[i]:this.noiseShape[i]);return n},i.prototype.call=function(e,n){var i=this;return t.tidy(function(){i.invokeCallHook(e,n);var r=y(e);if(null!=i.noiseShape&&!t.util.arraysEqual(r.shape,i.noiseShape))throw new pn("Non-default noise shape is not implemented in Dropout layer yet: "+JSON.stringify(i.noiseShape));if(0<i.rate&&i.rate<1){var a=null!=n.training&&n.training,o=i.getNoiseShape(r);return Re(function(){return we(r,i.rateScalar,o,i.seed)},function(){return r},a)}return e})},i.prototype.getConfig=function(){var t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},i.className="Dropout",i}(jn);t.serialization.SerializationMap.register(Xi);var $i=function(e){function i(t){var n=e.call(this,t)||this;if(n.activation=null,n.useBias=!0,n.kernel=null,n.bias=null,n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_BIAS_INITIALIZER="zeros",null==t.batchInputShape&&null==t.inputShape&&null!=t.inputDim){var i=null;null!=t.batchSize&&(i=t.batchSize),n.batchInputShape=[i,t.inputDim]}return n.units=t.units,n.activation=Bt(t.activation),null!=t.useBias&&(n.useBias=t.useBias),n.kernelInitializer=Et(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.biasInitializer=Et(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelConstraint=Fe(t.kernelConstraint),n.biasConstraint=Fe(t.biasConstraint),n.kernelRegularizer=qt(t.kernelRegularizer),n.biasRegularizer=qt(t.biasRegularizer),n.activityRegularizer=qt(t.activityRegularizer),n.inputSpec=[{minNDim:2}],n}return n(i,e),i.prototype.build=function(e){var t=(e=v(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(n={},n[-1]=t,n)}],this.built=!0;var n},i.prototype.computeOutputShape=function(e){var t=(e=v(e)).slice();return t[t.length-1]=this.units,t},i.prototype.call=function(e,n){var i=this;return t.tidy(function(){i.invokeCallHook(e,n);var t=de(y(e),i.kernel.read());return null!=i.bias&&(t=ye(t,i.bias.read())),null!=i.activation&&(t=i.activation.apply(t)),t})},i.prototype.getConfig=function(){var t={units:this.units,activation:Pt(this.activation),useBias:this.useBias,kernelInitializer:xt(this.kernelInitializer),biasInitializer:xt(this.biasInitializer),kernelRegularizer:Wt(this.kernelRegularizer),biasRegularizer:Wt(this.biasRegularizer),activityRegularizer:Wt(this.activityRegularizer),kernelConstraint:Me(this.kernelConstraint),biasConstraint:Me(this.biasConstraint)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},i.className="Dense",i}(jn);t.serialization.SerializationMap.register($i);var Yi=function(e){function i(t){var n=e.call(this,t||{})||this;return n.inputSpec=[{minNDim:3}],n}return n(i,e),i.prototype.computeOutputShape=function(e){for(var t=0,n=(e=v(e)).slice(1);t<n.length;t++)if(null==n[t])throw new hn('The shape of the input to "Flatten" is not fully defined (got '+e.slice(1)+'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.');return[e[0],F(e,1)]},i.prototype.call=function(e,n){var i=this;return t.tidy(function(){return i.invokeCallHook(e,n),Q(y(e))})},i.className="Flatten",i}(jn);t.serialization.SerializationMap.register(Yi);var Qi=function(e){function i(t){var n=e.call(this,t)||this;return n.supportsMasking=!0,n.activation=Bt(t.activation),n}return n(i,e),i.prototype.call=function(e,n){var i=this;return t.tidy(function(){i.invokeCallHook(e,n);var t=y(e);return i.activation.apply(t)})},i.prototype.getConfig=function(){var t={activation:Pt(this.activation)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},i.className="Activation",i}(jn);t.serialization.SerializationMap.register(Qi);var er=function(e){function i(t){var n=e.call(this,t)||this;return n.n=t.n,n.inputSpec=[{ndim:2}],n}return n(i,e),i.prototype.computeOutputShape=function(e){return[e[0],this.n,e[1]]},i.prototype.call=function(e,n){var i=this;return t.tidy(function(){return e=y(e),$(e,i.n)})},i.prototype.getConfig=function(){var t={n:this.n},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},i.className="RepeatVector",i}(jn);t.serialization.SerializationMap.register(er);var tr=function(e){function i(t){var n=e.call(this,t)||this;n.targetShape=t.targetShape;for(var i=0;i<n.targetShape.length;++i)n.isUnknown(n.targetShape[i])&&(n.targetShape[i]=null);return n}return n(i,e),i.prototype.isUnknown=function(e){return e<0||null==e},i.prototype.fixUnknownDimension=function(e,t){for(var n="Total size of new array must be unchanged.",i=t.slice(),r=1,a=null,o=0;o<i.length;++o){var s=i[o];if(this.isUnknown(s)){if(null!==a)throw new hn("Can only specifiy one unknown dimension.");a=o}else r*=s}var l=F(e);if(null!==a){if(0===r||l%r!=0)throw new hn(n);i[a]=l/r}else if(l!==r)throw new hn(n);return i},i.prototype.computeOutputShape=function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))},i.prototype.call=function(e,n){var i=this;return t.tidy(function(){i.invokeCallHook(e,n);var t=y(e),r=Z(t),a=r.slice(0,1).concat(i.fixUnknownDimension(r.slice(1),i.targetShape));return t.reshape(a)})},i.prototype.getConfig=function(){var t={targetShape:this.targetShape},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},i.className="Reshape",i}(jn);t.serialization.SerializationMap.register(tr);var nr=function(e){function i(t){var n=e.call(this,t)||this;if(n.embeddings=null,n.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==t.batchInputShape&&null==t.inputShape){var i=null;null!=t.batchSize&&(i=t.batchSize),null==t.inputLength?n.batchInputShape=[i,null]:n.batchInputShape=[i].concat(c(t.inputLength))}return n.inputDim=t.inputDim,n.outputDim=t.outputDim,n.embeddingsInitializer=Et(t.embeddingsInitializer||n.DEFAULT_EMBEDDINGS_INITIALIZER),n.embeddingsRegularizer=qt(t.embeddingsRegularizer),n.activityRegularizer=qt(t.activityRegularizer),n.embeddingsConstraint=Fe(t.embeddingsConstraint),n.maskZero=t.maskZero,n.inputLength=t.inputLength,n}return n(i,e),i.prototype.build=function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},i.prototype.computeMask=function(e,t){throw new pn("computeMask has not been implemented for Embedding yet")},i.prototype.computeOutputShape=function(e){if(e=v(e),null==this.inputLength)return e.concat([this.outputDim]);var t=c(this.inputLength);if(t.length!==e.length-1)throw new hn('"inputLength" is '+this.inputLength+", but received input shape has shape "+e);for(var n=0,i=0;i<t.length;++i){var r=t[i],a=e[i+1];if(null!=r&&null!=a&&r!==a)throw new hn('"inputLength" is '+this.inputLength+", but received input shape has shape "+e);null==r&&(t[n]=a),n++}return[e[0]].concat(t,[this.outputDim])},i.prototype.call=function(e,n){var i=this;return t.tidy(function(){i.invokeCallHook(e,n);var t=y(e);return"int32"!==H(t)&&(t=J(t,"int32")),fe(i.embeddings.read(),t.as1D()).reshape(v(i.computeOutputShape(t.shape)))})},i.prototype.getConfig=function(){var t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:xt(this.embeddingsInitializer),embeddingsRegularizer:Wt(this.embeddingsRegularizer),activityRegularizer:Wt(this.activityRegularizer),embeddingsConstraint:Me(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},i.className="Embedding",i}(jn);t.serialization.SerializationMap.register(nr);var ir=function(e){function i(t){var n=e.call(this,t||{})||this;return n.supportsMasking=!0,n}return n(i,e),i.prototype.mergeFunction=function(e){throw new pn},i.prototype.computeElementwiseOpOutputShape=function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),i=0;i<t.length;++i){var r=e[e.length-t.length+i],a=t[i];if(null==r||null==a||r<0||a<0)n.push(null);else if(1===r)n.push(a);else if(1===a)n.push(r);else{if(r!==a)throw new hn("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(r)}}return n},i.prototype.build=function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[v(e)]),(e=e).length<2)throw new hn("A merge layer should be called on an Array of at least 2 inputs. Got "+e.length+" input(s).");for(var t=[],n=0,i=e;n<i.length;n++)null!=(o=i[n])&&null!==o[0]&&t.push(o[0]);if((t=I(t)).length>1)throw new hn("Can not merge tensors with different batch sizes. Got tensors with shapes: "+JSON.stringify(e)+".");for(var r=null==e[0]?null:e[0].slice(1),a=1;a<e.length;++a){var o=null==e[a]?null:e[a].slice(1);r=this.computeElementwiseOpOutputShape(r,o)}var s=e.map(function(e){return e.length});-1===e.indexOf(null)&&1===I(s).length?this.reshapeRequired=!1:this.reshapeRequired=!0},i.prototype.call=function(e,n){var i=this;return t.tidy(function(){if(e=e,i.reshapeRequired){var n=[],r=e.map(function(e){return G(e)});if(-1===r.indexOf(null)){for(var a=P(r),o=0,s=e;o<s.length;o++){for(var l=G(d=s[o]),u=0;u<a-l;++u)d=X(d,1);n.push(d)}return i.mergeFunction(n)}for(var c=!1,h=0,p=e;h<p.length;h++){var d=p[h];if(null==(l=G(d))){var f=Z(d),g=f[0],m=f.slice(1).concat([g]),y=d.reshape([g].concat(F(f.slice(1))));y=(y=t.transpose(y,[1,0])).reshape(m),n.push(y),c=!0}else if(l>1){z=_(1,l).concat([0]);n.push(t.transpose(d,z)),c=!0}else n.push(d)}var v=i.mergeFunction(n),b=G(v);if(c)if(null==b){var w=Z(v),m=[g=w[w.length-1]].concat(w.slice(0,w.length-1));v=t.transpose(v.reshape([-1,g]),[1,0]).reshape(m)}else if(b>1){var z=[b-1].concat(_(0,b-1));v=t.transpose(v,z)}return v}return i.mergeFunction(e)})},i.prototype.computeOutputShape=function(e){var t;t=null==(e=e)[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var i=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,i)}for(var r=[],a=0,o=e;a<o.length;a++)null!=(i=o[a])&&null!==i[0]&&r.push(i[0]);return r=I(r),t=1===r.length?r.concat(t):[null].concat(t)},i}(jn),rr=function(e){function i(t){return e.call(this,t)||this}return n(i,e),i.prototype.mergeFunction=function(e){return t.tidy(function(){for(var n=t.zeros(e[0].shape),i=0,r=e;i<r.length;i++){var a=r[i];n=t.add(n,a)}return n})},i.className="Add",i}(ir);t.serialization.SerializationMap.register(rr);var ar=function(e){function i(t){return e.call(this,t)||this}return n(i,e),i.prototype.mergeFunction=function(e){return t.tidy(function(){for(var n=t.ones(e[0].shape),i=0,r=e;i<r.length;i++){var a=r[i];n=t.mul(n,a)}return n})},i.className="Multiply",i}(ir);t.serialization.SerializationMap.register(ar);var or=function(e){function i(t){return e.call(this,t)||this}return n(i,e),i.prototype.mergeFunction=function(e){return t.tidy(function(){for(var n=t.zeros(e[0].shape),i=0,r=e;i<r.length;i++){var a=r[i];n=t.add(n,a)}return ce(q(1/e.length),n)})},i.className="Average",i}(ir);t.serialization.SerializationMap.register(or);var sr=function(e){function i(t){return e.call(this,t)||this}return n(i,e),i.prototype.mergeFunction=function(e){return t.tidy(function(){for(var n=e[0],i=1;i<e.length;++i)n=t.maximum(n,e[i]);return n})},i.className="Maximum",i}(ir);t.serialization.SerializationMap.register(sr);var lr=function(e){function i(t){return e.call(this,t)||this}return n(i,e),i.prototype.mergeFunction=function(e){return t.tidy(function(){for(var n=e[0],i=1;i<e.length;++i)n=t.minimum(n,e[i]);return n})},i.className="Minimum",i}(ir);t.serialization.SerializationMap.register(lr);var ur=function(e){function i(t){var n=e.call(this,t)||this;return n.DEFAULT_AXIS=-1,null==t&&(t={}),n.axis=null==t.axis?n.DEFAULT_AXIS:t.axis,n.supportsMasking=!0,n.reshapeRequired=!1,n}return n(i,e),i.prototype.build=function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new hn("A `Concatenate` layer should be called on a list of at least 2 inputs");for(var n=!0,i=0,r=e=e;i<r.length;i++)if(null!=(h=r[i])){n=!1;break}if(!n){for(var a=[],o=0;o<e.length;++o){var s=e[o].slice();s.splice(this.axis,1);for(var l=!1,u=0,c=a;u<c.length;u++){var h=c[u];if(t.util.arraysEqual(h,s)){l=!0;break}}l||a.push(s)}if(a.length>1)throw new hn("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}},i.prototype.mergeFunction=function(e){var n=this;return t.tidy(function(){return oe(e,n.axis)})},i.prototype.computeOutputShape=function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new hn("A `Concatenate` layer should be called on a list of inputs.");for(var t=e,n=t[0].slice(),i=this.axis<0?n.length+this.axis:this.axis,r=0,a=t.slice(1);r<a.length;r++){var o=a[r];if(null==n[i]||null==o[i]){n[i]=null;break}n[i]+=o[i]}return n},i.className="Concatenate",i}(ir);t.serialization.SerializationMap.register(ur);var cr=function(e){function i(t){var n=e.call(this,t)||this;return n.supportsMasking=!0,n.axis=null==t.axis?-1:t.axis,n.momentum=null==t.momentum?.99:t.momentum,n.epsilon=null==t.epsilon?.001:t.epsilon,n.center=null==t.center||t.center,n.scale=null==t.scale||t.scale,n.betaInitializer=Et(t.betaInitializer||"zeros"),n.gammaInitializer=Et(t.gammaInitializer||"ones"),n.movingMeanInitializer=Et(t.movingMeanInitializer||"zeros"),n.movingVarianceInitializer=Et(t.movingVarianceInitializer||"ones"),n.betaConstraint=Fe(t.betaConstraint),n.gammaConstraint=Fe(t.gammaConstraint),n.betaRegularizer=qt(t.betaRegularizer),n.gammaRegularizer=qt(t.gammaRegularizer),n.stepCount=0,n}return n(i,e),i.prototype.build=function(e){e=v(e);var t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new hn("Axis "+t+" of input tensor should have a defined dimension but the layer received an input with shape "+JSON.stringify(e)+".");this.inputSpec=[new Pn({ndim:e.length,axes:(r={},r[t]=n,r)})];var i=[n];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0;var r},i.prototype.call=function(e,n){var i=this;return t.tidy(function(){var r=null!=n.training&&n.training,a=y(e),s=Z(a),l=s.length,u=_(0,l),c=i.axis>=0?i.axis:i.axis+l;u.splice(c,1);var h=o(1,l);h[c]=s[c];var p=u.slice();p.sort();var d=!t.util.arraysEqual(p,_(0,l).slice(0,l-1));if(!r)return function(){if(d){var e=i.movingMean.read().reshape(h),t=i.movingVariance.read().reshape(h),n=i.center?i.beta.read().reshape(h):null,r=i.scale?i.gamma.read().reshape(h):null;return me(a,e,t,n,r,i.epsilon)}return me(a,i.movingMean.read(),i.movingVariance.read(),null==i.beta?null:i.beta.read(),null==i.gamma?null:i.gamma.read(),i.epsilon)}();var f=ae(a,i.gamma.read(),i.beta.read(),u,i.epsilon),g=f[0],m=f[1],v=f[2],b=F(u.map(function(e){return a.shape[e]})),w=v.mul(q(b/(b-(1+i.epsilon))));return function(){i.stepCount++;var e=t.movingAverage(i.movingMean.read(),m,i.momentum,i.stepCount);i.movingMean.write(e);var n=t.movingAverage(i.movingVariance.read(),w,i.momentum,i.stepCount);i.movingVariance.write(n)}(),g})},i.prototype.getConfig=function(){var t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:xt(this.betaInitializer),gammaInitializer:xt(this.gammaInitializer),movingMeanInitializer:xt(this.movingMeanInitializer),movingVarianceInitializer:xt(this.movingVarianceInitializer),betaRegularizer:Wt(this.betaRegularizer),gammaRegularizer:Wt(this.gammaRegularizer),betaConstraint:Me(this.betaConstraint),gammaConstraint:Me(this.gammaConstraint)},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},i.className="BatchNormalization",i}(jn);t.serialization.SerializationMap.register(cr);var hr=function(e){function i(t){var n=this;if(null==t&&(t={}),n=e.call(this,t)||this,n.dataFormat=null==t.dataFormat?V():t.dataFormat,null==t.padding)n.padding=[[1,1],[1,1]];else if("number"==typeof t.padding)n.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,2!==t.padding.length)throw new hn("ZeroPadding2D expects padding to be a length-2 array, but received a length-"+t.padding.length+" array.");var i=void 0,r=void 0;if("number"==typeof t.padding[0])i=[t.padding[0],t.padding[0]],r=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,2!==t.padding[0].length)throw new hn("ZeroPadding2D expects height padding to be a length-2 array, but received a length-"+t.padding[0].length+" array.");if(i=t.padding[0],2!==t.padding[1].length)throw new hn("ZeroPadding2D expects width padding to be a length-2 array, but received a length-"+t.padding[1].length+" array.");r=t.padding[1]}n.padding=[i,r]}return n.inputSpec=[new Pn({ndim:4})],n}return n(i,e),i.prototype.computeOutputShape=function(e){e=v(e);var t,n;return"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])},i.prototype.call=function(e,n){var i=this;return t.tidy(function(){return Yt(y(e),i.padding,i.dataFormat)})},i.prototype.getConfig=function(){var t={padding:this.padding,dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},i.className="ZeroPadding2D",i}(jn);t.serialization.SerializationMap.register(hr);var pr=function(e){function i(t){var n=this;return null==t.poolSize&&(t.poolSize=2),n=e.call(this,t)||this,n.poolSize=[t.poolSize],n.strides=null==t.strides?n.poolSize:[t.strides],n.padding=null==t.padding?"valid":t.padding,C(n.padding),n.inputSpec=[new Pn({ndim:3})],n}return n(i,e),i.prototype.computeOutputShape=function(e){var t=Kt((e=v(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]},i.prototype.call=function(e,n){var i=this;return t.tidy(function(){i.invokeCallHook(e,n),e=X(y(e),2);var r=i.poolingFunction(y(e),[i.poolSize[0],1],[i.strides[0],1],i.padding,"channelsLast");return t.squeeze(r,[2])})},i.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},i}(jn),dr=function(e){function t(t){return e.call(this,t)||this}return n(t,e),t.prototype.poolingFunction=function(e,t,n,i,r){return k(r),C(i),Qt(e,t,n,i,r,"max")},t.className="MaxPooling1D",t}(pr);t.serialization.SerializationMap.register(dr);var fr=function(e){function t(t){return e.call(this,t)||this}return n(t,e),t.prototype.poolingFunction=function(e,t,n,i,r){return k(r),C(i),Qt(e,t,n,i,r,"avg")},t.className="AveragePooling1D",t}(pr);t.serialization.SerializationMap.register(fr);var gr=function(e){function i(t){var n=this;return null==t.poolSize&&(t.poolSize=[2,2]),n=e.call(this,t)||this,n.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],n.strides=null==t.strides?n.poolSize:t.strides,n.padding=null==t.padding?"valid":t.padding,n.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,k(n.dataFormat),C(n.padding),n.inputSpec=[new Pn({ndim:4})],n}return n(i,e),i.prototype.computeOutputShape=function(e){e=v(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=Kt(t,this.poolSize[0],this.padding,this.strides[0]),n=Kt(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]},i.prototype.call=function(e,n){var i=this;return t.tidy(function(){return i.invokeCallHook(e,n),i.poolingFunction(y(e),i.poolSize,i.strides,i.padding,i.dataFormat)})},i.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},i}(jn),mr=function(e){function t(t){return e.call(this,t)||this}return n(t,e),t.prototype.poolingFunction=function(e,t,n,i,r){return k(r),C(i),Qt(e,t,n,i,r,"max")},t.className="MaxPooling2D",t}(gr);t.serialization.SerializationMap.register(mr);var yr=function(e){function t(t){return e.call(this,t)||this}return n(t,e),t.prototype.poolingFunction=function(e,t,n,i,r){return k(r),C(i),Qt(e,t,n,i,r,"avg")},t.className="AveragePooling2D",t}(gr);t.serialization.SerializationMap.register(yr);var vr=function(e){function t(t){var n=e.call(this,t)||this;return n.inputSpec=[new Pn({ndim:3})],n}return n(t,e),t.prototype.computeOutputShape=function(e){return[e[0],e[2]]},t.prototype.call=function(e,t){throw new pn},t}(jn),br=function(e){function i(t){return e.call(this,t)||this}return n(i,e),i.prototype.call=function(e,n){return t.tidy(function(){var n=y(e);return t.mean(n,1)})},i.className="GlobalAveragePooling1D",i}(vr);t.serialization.SerializationMap.register(br);var wr=function(e){function i(t){return e.call(this,t)||this}return n(i,e),i.prototype.call=function(e,n){return t.tidy(function(){var n=y(e);return t.max(n,1)})},i.className="GlobalMaxPooling1D",i}(vr);t.serialization.SerializationMap.register(wr);var zr=function(e){function t(t){var n=e.call(this,t)||this;return n.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,k(n.dataFormat),n.inputSpec=[new Pn({ndim:4})],n}return n(t,e),t.prototype.computeOutputShape=function(e){return e=e,"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]},t.prototype.call=function(e,t){throw new pn},t.prototype.getConfig=function(){var t={dataFormat:this.dataFormat},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t}(jn),Ir=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return n(i,e),i.prototype.call=function(e,n){var i=this;return t.tidy(function(){var n=y(e);return"channelsLast"===i.dataFormat?t.mean(n,[1,2]):t.mean(n,[2,3])})},i.className="GlobalAveragePooling2D",i}(zr);t.serialization.SerializationMap.register(Ir);var Sr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return n(i,e),i.prototype.call=function(e,n){var i=this;return t.tidy(function(){var n=y(e);return"channelsLast"===i.dataFormat?t.max(n,[1,2]):t.max(n,[2,3])})},i.className="GlobalMaxPooling2D",i}(zr);t.serialization.SerializationMap.register(Sr);var Nr=function(e){function i(t){var n,i=e.call(this,t)||this;if(null==t.cell)throw new hn("cell property is missing for the constructor of RNN.");if(null==(n=Array.isArray(t.cell)?new Mr({cells:t.cell}):t.cell).stateSize)throw new hn("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return i.cell=n,i.returnSequences=null!=t.returnSequences&&t.returnSequences,i.returnState=null!=t.returnState&&t.returnState,i.goBackwards=null!=t.goBackwards&&t.goBackwards,i._stateful=null!=t.stateful&&t.stateful,i.unroll=null!=t.unroll&&t.unroll,i.supportsMasking=!0,i.inputSpec=[new Pn({ndim:3})],i.stateSpec=null,i.states=null,i.numConstants=null,i}return n(i,e),i.prototype.getStates=function(){return null==this.states?_(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(function(e){return null}):this.states},i.prototype.setStates=function(e){this.states=e},i.prototype.computeOutputShape=function(e){h(e)&&(e=e[0]),e=e;var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,i=t[0];if(n=this.returnSequences?[e[0],e[1],i]:[e[0],i],this.returnState){for(var r=[],a=0,o=t;a<o.length;a++){var s=o[a];r.push([e[0],s])}return[n].concat(r)}return n},i.prototype.computeMask=function(e,t){throw new pn("computeMask has not been implemented for RNN yet")},i.prototype.build=function(e){if(null!=this.numConstants)throw new pn("Constants support is not implemented in RNN yet.");h(e)&&(e=e[0]),e=e;var n=this.stateful?e[0]:null,i=e[e.length-1];this.inputSpec[0]=new Pn({shape:[n,null,i]});var r=[e[0]].concat(e.slice(2));this.cell.build(r);var a;if(a=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!t.util.arraysEqual(this.stateSpec.map(function(e){return e.shape[e.shape.length-1]}),a))throw new hn("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec="+this.stateSpec+"; However cell.stateSize is "+this.cell.stateSize)}else this.stateSpec=a.map(function(e){return new Pn({shape:[null,e]})});if(this.stateful)throw new pn("stateful RNN layer is not implemented yet")},i.prototype.resetStates=function(e){var n=this;t.tidy(function(){if(!n.stateful)throw new un("Cannot call resetState() on an RNN Layer that is not stateful.");var i=n.inputSpec[0].shape[0];if(null==i)throw new hn("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==n.states)Array.isArray(n.cell.stateSize)?n.states=n.cell.stateSize.map(function(e){return t.zeros([i,e])}):n.states=[t.zeros([i,n.cell.stateSize])];else if(null==e)Array.isArray(n.cell.stateSize)?n.states=n.cell.stateSize.map(function(e){return t.zeros([i,e])}):n.states[0]=t.zeros([i,n.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==n.states.length)throw new hn("Layer "+n.name+" expects "+n.states.length+" state(s), but it received "+e.length+" state value(s). Input received: "+e);for(var r=0;r<n.states.length;++r){var a=e[r],o=Array.isArray(n.cell.stateSize)?n.cell.stateSize[r]:n.cell.stateSize,s=[i,o];if(!t.util.arraysEqual(a.shape,s))throw new hn("State "+r+" is incompatible with layer "+n.name+": expected shape="+s+", received shape="+a.shape);n.states[r]=a}}})},i.prototype.standardizeArgs=function(e,t,n){function i(e){return null==e||Array.isArray(e)?e:[e]}if(Array.isArray(e)){if(null!=t||null!=n)throw new hn("When inputs is an array, neither initialState or constants should be provided");null!=this.numConstants&&(n=e.slice(e.length-this.numConstants,e.length),e=e.slice(0,e.length-this.numConstants)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}return t=i(t),n=i(n),{inputs:e,initialState:t,constants:n}},i.prototype.apply=function(t,n){var i=null==n?null:n.initialState,r=null==n?null:n.constants;null==n&&(n={});var a=this.standardizeArgs(t,i,r);t=a.inputs,i=a.initialState,r=a.constants;var o=[],s=[];if(null!=i){n.initialState=i,o=o.concat(i),this.stateSpec=[];for(var l=0,u=i;l<u.length;l++){var c=u[l];this.stateSpec.push(new Pn({shape:c.shape}))}s=s.concat(this.stateSpec)}if(null!=r&&(n.constants=r,o=o.concat(r),this.numConstants=r.length),o[0]instanceof Sn){var h=[t].concat(o),p=this.inputSpec.concat(s),d=this.inputSpec;this.inputSpec=p;var f=e.prototype.apply.call(this,h,n);return this.inputSpec=d,f}return e.prototype.apply.call(this,t,n)},i.prototype.call=function(e,n){var i=this;return t.tidy(function(){var t=null==n?null:n.mask,r=null==n?null:n.training,a=null==n?null:n.initialState;if(e=y(e),null==a){if(i.stateful)throw new pn("stateful RNN layer is not implemented yet.");a=i.getInitialState(e)}if(null!=t)throw new pn("Masking is not implemented for RNN yet");var o=Array.isArray(i.cell.stateSize)?i.cell.stateSize.length:1;if(a.length!==o)throw new hn("RNN Layer has "+o+" state(s) but was passed "+a.length+" initial state(s).");e.shape[1];i.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:r},l=en(function(e,t){var n=i.cell.call([e].concat(t),s);return[n[0],n.slice(1)]},e,a,i.goBackwards,null,null,i.unroll),u=l[0],c=l[1],h=l[2];if(i.stateful)throw new pn("stateful RNN layer is not implemented yet");var p=i.returnSequences?c:u;return i.returnState?[p].concat(h):p})},i.prototype.getInitialState=function(e){var n=this;return t.tidy(function(){var i=t.zeros(e.shape);return i=t.sum(i,[1,2]),i=X(i),Array.isArray(n.cell.stateSize)?n.cell.stateSize.map(function(e){return e>1?le(i,[1,e]):i}):n.cell.stateSize>1?[le(i,[1,n.cell.stateSize])]:[i]})},Object.defineProperty(i.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),i.prototype.getConfig=function(){var t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);var n=this.cell.getConfig();t.cell={className:this.cell.getClassName(),config:n};var i=e.prototype.getConfig.call(this);return Object.assign(t,i),t},i.className="RNN",i}(jn);t.serialization.SerializationMap.register(Nr);var kr=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return n(r,e),r=i([t.doc({heading:"Layers",subheading:"Classes"})],r)}(jn),Cr=function(e){function i(t){var n=e.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,n.activation=Bt(null==t.activation?n.DEFAULT_ACTIVATION:t.activation),n.useBias=null==t.useBias||t.useBias,n.kernelInitializer=Et(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Et(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Et(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=qt(t.kernelRegularizer),n.recurrentRegularizer=qt(t.recurrentRegularizer),n.biasRegularizer=qt(t.biasRegularizer),n.kernelConstraint=Fe(t.kernelConstraint),n.recurrentConstraint=Fe(t.recurrentConstraint),n.biasConstraint=Fe(t.biasConstraint),n.dropout=E([1,P([0,null==t.dropout?0:t.dropout])]),n.recurrentDropout=E([1,P([0,null==t.recurrentDropout?0:t.recurrentDropout])]),n.stateSize=n.units,n}return n(i,e),i.prototype.build=function(e){e=v(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},i.prototype.call=function(e,n){var i=this;return t.tidy(function(){if(2!==(e=e).length)throw new hn("SimpleRNNCell expects 2 input Tensors, got "+e.length+".");var n=e[1];if(e=e[0],0!==i.dropout||0!==i.recurrentDropout)throw new pn("Dropout is not implemented for SimpleRNNCell yet");var r=de(e,i.kernel.read());null!=i.bias&&(r=ye(r,i.bias.read()));var a=t.add(r,de(n,i.recurrentKernel.read()));return null!=i.activation&&(a=i.activation.apply(a)),[a,a]})},i.prototype.getConfig=function(){var t={units:this.units,activation:Pt(this.activation),useBias:this.useBias,kernelInitializer:xt(this.kernelInitializer),recurrentInitializer:xt(this.recurrentInitializer),biasInitializer:xt(this.biasInitializer),kernelRegularizer:Wt(this.kernelRegularizer),recurrentRegularizer:Wt(this.recurrentRegularizer),biasRegularizer:Wt(this.biasRegularizer),activityRegularizer:Wt(this.activityRegularizer),kernelConstraint:Me(this.kernelConstraint),recurrentConstraint:Me(this.recurrentConstraint),biasConstraint:Me(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},i.className="SimpleRNNCell",i}(kr);t.serialization.SerializationMap.register(Cr);var Lr=function(e){function i(t){return t.cell=new Cr(t),e.call(this,t)||this}return n(i,e),i.prototype.call=function(n,i){var r=this;return t.tidy(function(){var t=null==i?null:i.mask,a=null==i?null:i.training,o=null==i?null:i.initialState;return e.prototype.call.call(r,n,{mask:t,training:a,initialState:o})})},Object.defineProperty(i.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),i.prototype.getConfig=function(){var t={units:this.units,activation:Pt(this.activation),useBias:this.useBias,kernelInitializer:xt(this.kernelInitializer),recurrentInitializer:xt(this.recurrentInitializer),biasInitializer:xt(this.biasInitializer),kernelRegularizer:Wt(this.kernelRegularizer),recurrentRegularizer:Wt(this.recurrentRegularizer),biasRegularizer:Wt(this.biasRegularizer),activityRegularizer:Wt(this.activityRegularizer),kernelConstraint:Me(this.kernelConstraint),recurrentConstraint:Me(this.recurrentConstraint),biasConstraint:Me(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},n=e.prototype.getConfig.call(this);return delete n.cell,Object.assign(t,n),t},i.className="SimpleRNN",i}(Nr);t.serialization.SerializationMap.register(Lr);var Ar=function(e){function i(t){var n=e.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,n.activation=Bt(void 0===t.activation?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=Bt(void 0===t.activation?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=null==t.useBias||t.useBias,n.kernelInitializer=Et(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Et(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Et(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=qt(t.kernelRegularizer),n.recurrentRegularizer=qt(t.recurrentRegularizer),n.biasRegularizer=qt(t.biasRegularizer),n.kernelConstraint=Fe(t.kernelConstraint),n.recurrentConstraint=Fe(t.recurrentConstraint),n.biasConstraint=Fe(t.biasConstraint),n.dropout=E([1,P([0,null==t.dropout?0:t.dropout])]),n.recurrentDropout=E([1,P([0,null==t.recurrentDropout?0:t.recurrentDropout])]),n.implementation=t.implementation,n.stateSize=n.units,n}return n(i,e),i.prototype.build=function(e){var t=(e=v(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},i.prototype.call=function(e,n){var i=this;return t.tidy(function(){if(0!==i.dropout||0!==i.recurrentDropout)throw new pn("Dropout is not implemented for GRUCell yet");if(2!==(e=e).length)throw new hn("GRUCell expects 2 input Tensors (inputs, h, c), got "+e.length+".");var n=e[1];e=e[0];var r,a,o;if(1===i.implementation){var s=te(i.kernel.read(),0,i.units),l=te(i.kernel.read(),i.units,i.units),u=te(i.kernel.read(),2*i.units,i.units),c=te(i.recurrentKernel.read(),0,i.units),h=te(i.recurrentKernel.read(),i.units,i.units),p=te(i.recurrentKernel.read(),2*i.units,i.units),d=e,f=e,g=de(e,s),m=de(d,l),y=de(f,u);if(i.useBias){var v=ee(i.bias.read(),0,i.units),b=ee(i.bias.read(),i.units,i.units),w=ee(i.bias.read(),2*i.units,i.units);g=ye(g,v),m=ye(m,b),y=ye(y,w)}var z=n,I=n,S=n;r=i.recurrentActivation.apply(t.add(g,de(z,c))),a=i.recurrentActivation.apply(t.add(m,de(I,h))),o=i.activation.apply(t.add(y,de(t.mul(a,S),p)))}else{var N=de(e,i.kernel.read());i.useBias&&(N=ye(N,i.bias.read()));var k=de(n,te(i.recurrentKernel.read(),0,2*i.units)),g=te(N,0,i.units),m=te(N,i.units,i.units),C=te(k,0,i.units),L=te(k,i.units,i.units);r=i.recurrentActivation.apply(t.add(g,C)),a=i.recurrentActivation.apply(t.add(m,L));var y=te(N,2*i.units,i.units),A=de(t.mul(a,n),te(i.recurrentKernel.read(),2*i.units,i.units));o=i.activation.apply(t.add(y,A))}var T=t.add(t.mul(r,n),t.mul(he(q(1),t.neg(r)),o));return[T,T]})},i.prototype.getConfig=function(){var t={units:this.units,activation:Pt(this.activation),useBias:this.useBias,kernelInitializer:xt(this.kernelInitializer),recurrentInitializer:xt(this.recurrentInitializer),biasInitializer:xt(this.biasInitializer),kernelRegularizer:Wt(this.kernelRegularizer),recurrentRegularizer:Wt(this.recurrentRegularizer),biasRegularizer:Wt(this.biasRegularizer),activityRegularizer:Wt(this.activityRegularizer),kernelConstraint:Me(this.kernelConstraint),recurrentConstraint:Me(this.recurrentConstraint),biasConstraint:Me(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},i.className="GRUCell",i}(kr);t.serialization.SerializationMap.register(Ar);var Tr=function(e){function i(t){return 0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Ar(t),e.call(this,t)||this}return n(i,e),i.prototype.call=function(n,i){var r=this;return t.tidy(function(){var t=null==i?null:i.mask,a=null==i?null:i.training,o=null==i?null:i.initialState;return e.prototype.call.call(r,n,{mask:t,training:a,initialState:o})})},Object.defineProperty(i.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),i.prototype.getConfig=function(){var t={units:this.units,activation:Pt(this.activation),useBias:this.useBias,kernelInitializer:xt(this.kernelInitializer),recurrentInitializer:xt(this.recurrentInitializer),biasInitializer:xt(this.biasInitializer),kernelRegularizer:Wt(this.kernelRegularizer),recurrentRegularizer:Wt(this.recurrentRegularizer),biasRegularizer:Wt(this.biasRegularizer),activityRegularizer:Wt(this.activityRegularizer),kernelConstraint:Me(this.kernelConstraint),recurrentConstraint:Me(this.recurrentConstraint),biasConstraint:Me(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=e.prototype.getConfig.call(this);return delete n.cell,Object.assign(t,n),t},i.fromConfig=function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)},i.className="GRU",i}(Nr);t.serialization.SerializationMap.register(Tr);var Rr=function(e){function i(t){var n=e.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,n.activation=Bt(void 0===t.activation?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=Bt(void 0===t.activation?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=null==t.useBias||t.useBias,n.kernelInitializer=Et(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Et(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Et(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.unitForgetBias=t.unitForgetBias,n.kernelRegularizer=qt(t.kernelRegularizer),n.recurrentRegularizer=qt(t.recurrentRegularizer),n.biasRegularizer=qt(t.biasRegularizer),n.kernelConstraint=Fe(t.kernelConstraint),n.recurrentConstraint=Fe(t.recurrentConstraint),n.biasConstraint=Fe(t.biasConstraint),n.dropout=E([1,P([0,null==t.dropout?0:t.dropout])]),n.recurrentDropout=E([1,P([0,null==t.recurrentDropout?0:t.recurrentDropout])]),n.implementation=t.implementation,n.stateSize=[n.units,n.units],n}return n(i,e),i.prototype.build=function(e){var t=(e=v(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);var i;if(this.useBias){if(this.unitForgetBias){var r=this.biasInitializer,a=this.units;i=new(o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.apply=function(e,t){var n=r.apply([a]),i=(new hi).apply([a]),o=r.apply([2*a]);return se(se(n,i),o)},t}(ui),o.className="CustomInit",o)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0;var o},i.prototype.call=function(e,n){var i=this;return t.tidy(function(){if(0!==i.dropout||0!==i.recurrentDropout)throw new pn("Dropout is not implemented for LSTMCell yet");if(3!==(e=e).length)throw new hn("LSTMCell expects 3 input Tensors (inputs, h, c), got "+e.length+".");var n=e[1],r=e[2];e=e[0];var a,o,s,l;if(1===i.implementation){var u=te(i.kernel.read(),0,i.units),c=te(i.kernel.read(),i.units,i.units),h=te(i.kernel.read(),2*i.units,i.units),p=te(i.kernel.read(),3*i.units,i.units),d=te(i.recurrentKernel.read(),0,i.units),f=te(i.recurrentKernel.read(),i.units,i.units),g=te(i.recurrentKernel.read(),2*i.units,i.units),m=te(i.recurrentKernel.read(),3*i.units,i.units),y=e,v=e,b=e,w=de(e,u),z=de(y,c),I=de(v,h),S=de(b,p);if(i.useBias){var N=ee(i.bias.read(),0,i.units),k=ee(i.bias.read(),i.units,i.units),C=ee(i.bias.read(),2*i.units,i.units),L=ee(i.bias.read(),3*i.units,i.units);w=ye(w,N),z=ye(z,k),I=ye(I,C),S=ye(S,L)}var A=n,T=n,R=n,D=n;a=i.recurrentActivation.apply(t.add(w,de(A,d))),o=i.recurrentActivation.apply(t.add(z,de(T,f))),s=t.add(t.mul(o,r),t.mul(a,i.activation.apply(t.add(I,de(R,g))))),l=i.recurrentActivation.apply(t.add(S,de(D,m)))}else{var M=de(e,i.kernel.read());M=t.add(M,de(n,i.recurrentKernel.read())),i.useBias&&(M=ye(M,i.bias.read()));var O=te(M,0,i.units),F=te(M,i.units,i.units),x=te(M,2*i.units,i.units),E=te(M,3*i.units,i.units);a=i.recurrentActivation.apply(O),o=i.recurrentActivation.apply(F),s=t.add(t.mul(o,r),t.mul(a,i.activation.apply(x))),l=i.recurrentActivation.apply(E)}var P=t.mul(l,i.activation.apply(s));return[P,P,s]})},i.prototype.getConfig=function(){var t={units:this.units,activation:Pt(this.activation),useBias:this.useBias,kernelInitializer:xt(this.kernelInitializer),recurrentInitializer:xt(this.recurrentInitializer),biasInitializer:xt(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Wt(this.kernelRegularizer),recurrentRegularizer:Wt(this.recurrentRegularizer),biasRegularizer:Wt(this.biasRegularizer),activityRegularizer:Wt(this.activityRegularizer),kernelConstraint:Me(this.kernelConstraint),recurrentConstraint:Me(this.recurrentConstraint),biasConstraint:Me(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},i.className="LSTMCell",i}(kr);t.serialization.SerializationMap.register(Rr);var Dr=function(e){function i(t){return 0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Rr(t),e.call(this,t)||this}return n(i,e),i.prototype.call=function(n,i){var r=this;return t.tidy(function(){var t=null==i?null:i.mask,a=null==i?null:i.training,o=null==i?null:i.initialState;return e.prototype.call.call(r,n,{mask:t,training:a,initialState:o})})},Object.defineProperty(i.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"unitForgetBias",{get:function(){return this.cell.unitForgetBias},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),i.prototype.getConfig=function(){var t={units:this.units,activation:Pt(this.activation),useBias:this.useBias,kernelInitializer:xt(this.kernelInitializer),recurrentInitializer:xt(this.recurrentInitializer),biasInitializer:xt(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Wt(this.kernelRegularizer),recurrentRegularizer:Wt(this.recurrentRegularizer),biasRegularizer:Wt(this.biasRegularizer),activityRegularizer:Wt(this.activityRegularizer),kernelConstraint:Me(this.kernelConstraint),recurrentConstraint:Me(this.recurrentConstraint),biasConstraint:Me(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=e.prototype.getConfig.call(this);return delete n.cell,Object.assign(t,n),t},i.fromConfig=function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)},i.className="LSTM",i}(Nr);t.serialization.SerializationMap.register(Dr);var Mr=function(e){function i(t){var n=e.call(this,t)||this;return n.cells=t.cells,n}return n(i,e),Object.defineProperty(i.prototype,"stateSize",{get:function(){for(var e=[],t=0,n=this.cells.slice().reverse();t<n.length;t++){var i=n[t];Array.isArray(i.stateSize)?e.push.apply(e,i.stateSize):e.push(i.stateSize)}return e},enumerable:!0,configurable:!0}),i.prototype.call=function(e,n){var i=this;return t.tidy(function(){for(var t=(e=e).slice(1),r=[],a=0,o=i.cells.slice().reverse();a<o.length;a++){c=o[a];Array.isArray(c.stateSize)?r.push(t.splice(0,c.stateSize.length)):r.push(t.splice(0,1))}r.reverse();for(var s,l=[],u=0;u<i.cells.length;++u){var c=i.cells[u];t=r[u],s=0===u?[e[0]].concat(t):[s[0]].concat(t),s=c.call(s,n),l.push(s.slice(1))}t=[];for(var h=0,p=l.slice().reverse();h<p.length;h++){var d=p[h];t.push.apply(t,d)}return[s[0]].concat(t)})},i.prototype.build=function(e){h(e)&&(e=e[0]),e=e;for(var t,n=0,i=this.cells;n<i.length;n++){var r=i[n];r.build(e),t=Array.isArray(r.stateSize)?r.stateSize[0]:r.stateSize,e=[e[0],t]}this.built=!0},i.prototype.getConfig=function(){for(var t=[],n=0,i=this.cells;n<i.length;n++){var r=i[n];t.push({className:this.getClassName(),config:r.getConfig()})}var a={cells:t},o=e.prototype.getConfig.call(this);return Object.assign(a,o),a},i.fromConfig=function(e,t,n){void 0===n&&(n={});for(var i=[],r=0,a=t.cells;r<a.length;r++){var o=a[r];i.push(xe(o,n))}return new e({cells:i})},Object.defineProperty(i.prototype,"trainableWeights",{get:function(){if(!this.trainable)return[];for(var e=[],t=0,n=this.cells;t<n.length;t++){var i=n[t];e.push.apply(e,i.trainableWeights)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"nonTrainableWeights",{get:function(){for(var e=[],t=0,n=this.cells;t<n.length;t++){o=n[t];e.push.apply(e,o.nonTrainableWeights)}if(!this.trainable){for(var i=[],r=0,a=this.cells;r<a.length;r++){var o=a[r];i.push.apply(i,o.trainableWeights)}return i.concat(e)}return e},enumerable:!0,configurable:!0}),i.prototype.getWeights=function(){for(var e=[],t=0,n=this.cells;t<n.length;t++){var i=n[t];e.push.apply(e,i.weights)}return j(e)},i.prototype.setWeights=function(e){for(var t=[],n=0,i=this.cells;n<i.length;n++)for(var r=i[n],a=r.weights.length,o=e.splice(a),s=0;s<r.weights.length;++s)t.push([r.weights[s],o[s]]);W(t)},i.className="StackedRNNCells",i}(kr);t.serialization.SerializationMap.register(Mr);var Or=function(e){function t(t){var n=e.call(this,t)||this;return n.layer=t.layer,n}return n(t,e),t.prototype.build=function(e){this.built=!0},Object.defineProperty(t.prototype,"trainable",{get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),t.prototype.getWeights=function(){return this.layer.getWeights()},t.prototype.setWeights=function(e){this.layer.setWeights(e)},t.prototype.getConfig=function(){var t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=e.prototype.getConfig.call(this);return Object.assign(t,n),t},t.fromConfig=function(e,t,n){void 0===n&&(n={});var i=xe(t.layer,n);delete t.layer;var r={layer:i};return Object.assign(r,t),new e(r)},t}(jn),Fr=function(e){function i(t){var n=e.call(this,t)||this;return n.supportsMasking=!0,n}return n(i,e),i.prototype.build=function(t){if((t=v(t)).length<3)throw new hn("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(t));this.inputSpec=[{shape:t}];var n=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),e.prototype.build.call(this,t)},i.prototype.computeOutputShape=function(e){var t=[(e=v(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),i=e[1];return[n[0],i].concat(n.slice(1))},i.prototype.call=function(e,n){var i=this;return t.tidy(function(){return en(function(e,t){return[i.layer.call(e,n),[]]},e=y(e),[],!1,null,null,!1,e.shape[1])[1]})},i.className="TimeDistributed",i}(Or);t.serialization.SerializationMap.register(Fr);var xr=["sum","mul","concat","ave"],Er=function(e){function i(t){var n=e.call(this,t)||this;n.forwardLayer=t.layer;var i=t.layer.getConfig();if(i.goBackwards=!0!==i.goBackwards,n.backwardLayer=xe({className:t.layer.getClassName(),config:i}),n.forwardLayer.name="forward_"+n.forwardLayer.name,n.backwardLayer.name="backward_"+n.backwardLayer.name,tn(t.mergeMode),n.mergeMode=t.mergeMode,t.weights)throw new pn("weights support is not implemented for Bidirectional layer yet.");return n._stateful=t.layer.stateful,n.returnSequences=t.layer.returnSequences,n.returnState=t.layer.returnState,n.supportsMasking=!0,n._trainable=!0,n.inputSpec=t.layer.inputSpec,n}return n(i,e),Object.defineProperty(i.prototype,"trainable",{get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)},enumerable:!0,configurable:!0}),i.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},i.prototype.setWeights=function(e){var t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))},i.prototype.computeOutputShape=function(e){var t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;var n,i,r;return this.returnState?(r=t.slice(1),n=t[0]):n=t[0],n=n,"concat"===this.mergeMode?(n[n.length-1]*=2,i=[n]):i=null==this.mergeMode?[n,n.slice()]:[n],this.returnState?null==this.mergeMode?i.concat(r).concat(r.slice()):[n].concat(r).concat(r.slice()):u(i)},i.prototype.apply=function(t,n){var i=null;if(null!=n&&(i=n.initialState),Array.isArray(t)&&(i=t.slice(1),t=t[0]),null==i||0===i.length)return e.prototype.apply.call(this,t,n);throw new pn("The support for initial states is not implemented for Bidirectional layers yet.")},i.prototype.call=function(e,n){var i=this;return t.tidy(function(){if(null!=n.mask)throw new pn("The support for masking is not implemented for Bidirectional layers yet.");if(null!=n.initialState)throw new pn("The support for initial states is not implemented for Bidirectional layers yet.");var r,a=i.forwardLayer.call(e,n),o=i.backwardLayer.call(e,n);i.returnState&&(Array.isArray(a)&&(r=a.slice(1).concat(o.slice(1))),a=a[0],o=o[0]),i.returnSequences&&(o=t.reverse(o,1));var s;return"concat"===i.mergeMode?s=oe([a,o]):"sum"===i.mergeMode?s=t.add(a,o):"ave"===i.mergeMode?s=ce(q(.5),t.add(a,o)):"mul"===i.mergeMode?s=t.mul(a,o):null==i.mergeMode&&(s=[a,o]),i.returnState?null==i.mergeMode?s.concat(r):[s].concat(r):s})},i.prototype.resetStates=function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},i.prototype.build=function(e){var t=this;Ie(this.forwardLayer.name,function(){t.forwardLayer.build(e)}),Ie(this.backwardLayer.name,function(){t.backwardLayer.build(e)}),this.built=!0},Object.defineProperty(i.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),i.className="Bidirectional",i}(Or);t.serialization.SerializationMap.register(Er);var Pr=function(e){function s(t){var n=e.call(this,{inputs:[],outputs:[]})||this;if(t=t||{},n.trainable=!0,n._updatable=!0,n.built=!1,n.name=null!=t.name?t.name:Ne("sequential_"),null!=t.layers)for(var i=0,r=t.layers;i<r.length;i++){var a=r[i];n.add(a)}return n}return n(s,e),l=s,s.prototype.add=function(e){if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new hn("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var t=Ue({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(t)}if(1!==e.inboundNodes.length)throw new hn("A layer added to a Sequential model must not already be connected somewhere else. Model received layer "+e.name+" which has "+e.inboundNodes.length+" pre-existing inbound connections.");if(1!==e.inboundNodes[0].outputTensors.length)throw new hn("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=je(this.outputs[0]),new Bn({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:o(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(e){return e.shape}),outputShapes:this.outputs[0].shape})}else{var n=e.apply(this.outputs[0]);if(Array.isArray(n))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.outputs=[n],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1},s.prototype.pop=function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},s.prototype.call=function(e,t){return null==this.model&&this.build(),this.model.call(e,t)},s.prototype.build=function(e){if(0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new oi({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.model.updatable=this.updatable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},s.prototype.setWeights=function(e){null==this.model&&this.build(),this.model.setWeights(e)},Object.defineProperty(s.prototype,"updatable",{get:function(){return this._updatable},set:function(e){this.built&&(this.model.updatable=e),this._updatable=e},enumerable:!0,configurable:!0}),s.prototype.evaluate=function(e,t,n){if(void 0===n&&(n={}),!this.built)throw new cn("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)},s.prototype.predict=function(e,t){return void 0===t&&(t={}),null==this.model&&this.build(),this.model.predict(e,t)},s.prototype.predictOnBatch=function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)},s.prototype.compile=function(e){this.build(),this.model.compile(e),this.optimizer=this.model.optimizer,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},s.prototype.fit=function(e,t,n){return void 0===n&&(n={}),r(this,void 0,void 0,function(){return a(this,function(i){if(!this.built)throw new cn("The model needs to be compiled before being used.");return[2,this.model.fit(e,t,n)]})})},s.fromConfig=function(e,t){var n=new e({});if(!(n instanceof l))throw new hn("Sequential.fromConfig called on non-Sequential input: "+n);if(!(t instanceof Array))throw new hn("Sequential.fromConfig called without an array of configs");if(null==t[0].className||"Merge"===t[0].className)throw new hn("Legacy serialization format not supported yet.");for(var i=0,r=t;i<r.length;i++){var a=xe(r[i]);n.add(a)}return n},s.prototype.getConfig=function(){for(var e=[],t=0,n=this.layers;t<n.length;t++){var i=n[t];e.push({className:i.getClassName(),config:i.getConfig()})}return e},s.className="Sequential",i([t.doc({heading:"Models",subheading:"Classes"})],s.prototype,"add",null),i([t.doc({heading:"Models",subheading:"Classes",configParamIndices:[2]})],s.prototype,"evaluate",null),i([t.doc({heading:"Models",subheading:"Classes",configParamIndices:[1]})],s.prototype,"predict",null),i([t.doc({heading:"Models",subheading:"Classes",configParamIndices:[2]})],s.prototype,"fit",null),s=l=i([t.doc({heading:"Models",subheading:"Classes"})],s);var l}(oi);t.serialization.SerializationMap.register(Pr);var _r=function(){function e(){}return e.model=function(e){return new oi(e)},e.sequential=function(e){return new Pr(e)},e.loadModel=function(e){return rn(e)},e.input=function(e){return Ue(e)},i([t.doc({heading:"Models",subheading:"Creation",configParamIndices:[0]})],e,"model",null),i([t.doc({heading:"Models",subheading:"Creation",configParamIndices:[0]})],e,"sequential",null),i([t.doc({heading:"Models",subheading:"Loading",useDocsFrom:"loadModelInternal"})],e,"loadModel",null),i([t.doc({heading:"Models",subheading:"Inputs",useDocsFrom:"Input",configParamIndices:[0]})],e,"input",null),e}(),Br=function(){function e(){}return e.inputLayer=function(e){return new Wn(e)},e.elu=function(e){return new Pi(e)},e.leakyReLU=function(e){return new Ei(e)},e.softmax=function(e){return new Bi(e)},e.thresholdedReLU=function(e){return new _i(e)},e.conv1d=function(e){return new Gi(e)},e.conv2d=function(e){return new qi(e)},e.conv2dTranspose=function(e){return new Zi(e)},e.separableConv2d=function(e){return new Ki(e)},e.cropping2D=function(e){return new Hi(e)},e.depthwiseConv2d=function(e){return new Ji(e)},e.activation=function(e){return new Qi(e)},e.dense=function(e){return new $i(e)},e.dropout=function(e){return new Xi(e)},e.flatten=function(e){return new Yi(e)},e.repeatVector=function(e){return new er(e)},e.reshape=function(e){return new tr(e)},e.embedding=function(e){return new nr(e)},e.add=function(e){return new rr(e)},e.average=function(e){return new or(e)},e.concatenate=function(e){return new ur(e)},e.maximum=function(e){return new sr(e)},e.minimum=function(e){return new lr(e)},e.multiply=function(e){return new ar(e)},e.batchNormalization=function(e){return new cr(e)},e.zeroPadding2d=function(e){return new hr(e)},e.averagePooling1d=function(e){return new fr(e)},e.avgPool1d=function(t){return e.averagePooling1d(t)},e.avgPooling1d=function(t){return e.averagePooling1d(t)},e.averagePooling2d=function(e){return new yr(e)},e.avgPool2d=function(t){return e.averagePooling2d(t)},e.avgPooling2d=function(t){return e.averagePooling2d(t)},e.globalAveragePooling1d=function(e){return new br(e)},e.globalAveragePooling2d=function(e){return new Ir(e)},e.globalMaxPooling1d=function(e){return new wr(e)},e.globalMaxPooling2d=function(e){return new Sr(e)},e.maxPooling1d=function(e){return new dr(e)},e.maxPooling2d=function(e){return new mr(e)},e.gru=function(e){return new Tr(e)},e.gruCell=function(e){return new Ar(e)},e.lstm=function(e){return new Dr(e)},e.lstmCell=function(e){return new Rr(e)},e.simpleRNN=function(e){return new Lr(e)},e.simpleRNNCell=function(e){return new Cr(e)},e.rnn=function(e){return new Nr(e)},e.stackedRNNCells=function(e){return new Mr(e)},e.bidirectional=function(e){return new Er(e)},e.timeDistributed=function(e){return new Fr(e)},e.Layer=jn,e.RNN=Nr,e.RNNCell=kr,e.input=_r.input,i([t.doc({heading:"Layers",subheading:"Inputs",namespace:"layers",useDocsFrom:"InputLayer",configParamIndices:[0]})],e,"inputLayer",null),i([t.doc({heading:"Layers",subheading:"Advanced Activation",namespace:"layers",useDocsFrom:"ELU",configParamIndices:[0]})],e,"elu",null),i([t.doc({heading:"Layers",subheading:"Advanced Activation",namespace:"layers",useDocsFrom:"LeakyReLU",configParamIndices:[0]})],e,"leakyReLU",null),i([t.doc({heading:"Layers",subheading:"Advanced Activation",namespace:"layers",useDocsFrom:"Softmax",configParamIndices:[0]})],e,"softmax",null),i([t.doc({heading:"Layers",subheading:"Advanced Activation",namespace:"layers",useDocsFrom:"ThresholdedReLU",configParamIndices:[0]})],e,"thresholdedReLU",null),i([t.doc({heading:"Layers",subheading:"Convolutional",namespace:"layers",useDocsFrom:"Conv1D",configParamIndices:[0]})],e,"conv1d",null),i([t.doc({heading:"Layers",subheading:"Convolutional",namespace:"layers",useDocsFrom:"Conv2D",configParamIndices:[0]})],e,"conv2d",null),i([t.doc({heading:"Layers",subheading:"Convolutional",namespace:"layers",useDocsFrom:"Conv2DTranspose",configParamIndices:[0]})],e,"conv2dTranspose",null),i([t.doc({heading:"Layers",subheading:"Convolutional",namespace:"layers",useDocsFrom:"SeparableConv2D",configParamIndices:[0]})],e,"separableConv2d",null),i([t.doc({heading:"Layers",subheading:"Convolutional",namespace:"layers",useDocsFrom:"Cropping2D",configParamIndices:[0]})],e,"cropping2D",null),i([t.doc({heading:"Layers",subheading:"Convolutional",namespace:"layers",useDocsFrom:"DepthwiseConv2D",configParamIndices:[0]})],e,"depthwiseConv2d",null),i([t.doc({heading:"Layers",subheading:"Basic",namespace:"layers",useDocsFrom:"Activation",configParamIndices:[0]})],e,"activation",null),i([t.doc({heading:"Layers",subheading:"Basic",namespace:"layers",useDocsFrom:"Dense",configParamIndices:[0]})],e,"dense",null),i([t.doc({heading:"Layers",subheading:"Basic",namespace:"layers",useDocsFrom:"Dropout",configParamIndices:[0]})],e,"dropout",null),i([t.doc({heading:"Layers",subheading:"Basic",namespace:"layers",useDocsFrom:"Flatten",configParamIndices:[0]})],e,"flatten",null),i([t.doc({heading:"Layers",subheading:"Basic",namespace:"layers",useDocsFrom:"RepeatVector",configParamIndices:[0]})],e,"repeatVector",null),i([t.doc({heading:"Layers",subheading:"Basic",namespace:"layers",useDocsFrom:"Reshape",configParamIndices:[0]})],e,"reshape",null),i([t.doc({heading:"Layers",subheading:"Basic",namespace:"layers",useDocsFrom:"Embedding",configParamIndices:[0]})],e,"embedding",null),i([t.doc({heading:"Layers",subheading:"Merge",namespace:"layers",useDocsFrom:"Add",configParamIndices:[0]})],e,"add",null),i([t.doc({heading:"Layers",subheading:"Merge",namespace:"layers",useDocsFrom:"Average",configParamIndices:[0]})],e,"average",null),i([t.doc({heading:"Layers",subheading:"Merge",namespace:"layers",useDocsFrom:"Concatenate",configParamIndices:[0]})],e,"concatenate",null),i([t.doc({heading:"Layers",subheading:"Merge",namespace:"layers",useDocsFrom:"Maximum",configParamIndices:[0]})],e,"maximum",null),i([t.doc({heading:"Layers",subheading:"Merge",namespace:"layers",useDocsFrom:"Minimum",configParamIndices:[0]})],e,"minimum",null),i([t.doc({heading:"Layers",subheading:"Merge",namespace:"layers",useDocsFrom:"Multiply",configParamIndices:[0]})],e,"multiply",null),i([t.doc({heading:"Layers",subheading:"Normalization",namespace:"layers",useDocsFrom:"BatchNormalization",configParamIndices:[0]})],e,"batchNormalization",null),i([t.doc({heading:"Layers",subheading:"Padding",namespace:"layers",useDocsFrom:"ZeroPadding2D",configParamIndices:[0]})],e,"zeroPadding2d",null),i([t.doc({heading:"Layers",subheading:"Pooling",namespace:"layers",useDocsFrom:"AveragePooling1D",configParamIndices:[0]})],e,"averagePooling1d",null),i([t.doc({heading:"Layers",subheading:"Pooling",namespace:"layers",useDocsFrom:"AveragePooling2D",configParamIndices:[0]})],e,"averagePooling2d",null),i([t.doc({heading:"Layers",subheading:"Pooling",namespace:"layers",useDocsFrom:"GlobalAveragePooling1D",configParamIndices:[0]})],e,"globalAveragePooling1d",null),i([t.doc({heading:"Layers",subheading:"Pooling",namespace:"layers",useDocsFrom:"GlobalAveragePooling2D",configParamIndices:[0]})],e,"globalAveragePooling2d",null),i([t.doc({heading:"Layers",subheading:"Pooling",namespace:"layers",useDocsFrom:"GlobalMaxPooling1D",configParamIndices:[0]})],e,"globalMaxPooling1d",null),i([t.doc({heading:"Layers",subheading:"Pooling",namespace:"layers",useDocsFrom:"GlobalMaxPooling2D",configParamIndices:[0]})],e,"globalMaxPooling2d",null),i([t.doc({heading:"Layers",subheading:"Pooling",namespace:"layers",useDocsFrom:"MaxPooling1D",configParamIndices:[0]})],e,"maxPooling1d",null),i([t.doc({heading:"Layers",subheading:"Pooling",namespace:"layers",useDocsFrom:"MaxPooling2D",configParamIndices:[0]})],e,"maxPooling2d",null),i([t.doc({heading:"Layers",subheading:"Recurrent",namespace:"layers",useDocsFrom:"GRU",configParamIndices:[0]})],e,"gru",null),i([t.doc({heading:"Layers",subheading:"Recurrent",namespace:"layers",useDocsFrom:"GRUCell",configParamIndices:[0]})],e,"gruCell",null),i([t.doc({heading:"Layers",subheading:"Recurrent",namespace:"layers",useDocsFrom:"LSTM",configParamIndices:[0]})],e,"lstm",null),i([t.doc({heading:"Layers",subheading:"Recurrent",namespace:"layers",useDocsFrom:"LSTMCell",configParamIndices:[0]})],e,"lstmCell",null),i([t.doc({heading:"Layers",subheading:"Recurrent",namespace:"layers",useDocsFrom:"SimpleRNN",configParamIndices:[0]})],e,"simpleRNN",null),i([t.doc({heading:"Layers",subheading:"Recurrent",namespace:"layers",useDocsFrom:"SimpleRNNCell",configParamIndices:[0]})],e,"simpleRNNCell",null),i([t.doc({heading:"Layers",subheading:"Recurrent",namespace:"layers",useDocsFrom:"RNN",configParamIndices:[0]})],e,"rnn",null),i([t.doc({heading:"Layers",subheading:"Recurrent",namespace:"layers",useDocsFrom:"RNN",configParamIndices:[0]})],e,"stackedRNNCells",null),i([t.doc({heading:"Layers",subheading:"Wrapper",namespace:"layers",useDocsFrom:"Bidirectional",configParamIndices:[0]})],e,"bidirectional",null),i([t.doc({heading:"Layers",subheading:"Wrapper",namespace:"layers",useDocsFrom:"TimeDistributed",configParamIndices:[0]})],e,"timeDistributed",null),e}(),Ur=function(){function e(){}return e.maxNorm=function(e){return new Mn(e)},e.unitNorm=function(e){return new On(e)},e.nonNeg=function(){return new Fn},e.minMaxNorm=function(e){return new xn(e)},i([t.doc({heading:"Constraints",namespace:"constraints",useDocsFrom:"MaxNorm",configParamIndices:[0]})],e,"maxNorm",null),i([t.doc({heading:"Constraints",namespace:"constraints",useDocsFrom:"UnitNorm",configParamIndices:[0]})],e,"unitNorm",null),i([t.doc({heading:"Constraints",namespace:"constraints",useDocsFrom:"NonNeg"})],e,"nonNeg",null),i([t.doc({heading:"Constraints",namespace:"constraints",useDocsFrom:"MinMaxNormConfig",configParamIndices:[0]})],e,"minMaxNorm",null),e}(),jr=function(){function e(){}return e.zeros=function(){return new ci},e.ones=function(){return new hi},e.constant=function(e){return new pi(e)},e.randomUniform=function(e){return new di(e)},e.randomNormal=function(e){return new fi(e)},e.truncatedNormal=function(e){return new gi(e)},e.identity=function(e){return new mi(e)},e.varianceScaling=function(e){return new yi(e)},e.glorotUniform=function(e){return new vi(e)},e.glorotNormal=function(e){return new bi(e)},e.heNormal=function(e){return new wi(e)},e.leCunNormal=function(e){return new zi(e)},e.orthogonal=function(e){return new Ii(e)},i([t.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"Zeros"})],e,"zeros",null),i([t.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"Ones"})],e,"ones",null),i([t.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"Constant",configParamIndices:[0]})],e,"constant",null),i([t.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"RandomUniform",configParamIndices:[0]})],e,"randomUniform",null),i([t.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"RandomNormal",configParamIndices:[0]})],e,"randomNormal",null),i([t.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"TruncatedNormal",configParamIndices:[0]})],e,"truncatedNormal",null),i([t.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"Identity",configParamIndices:[0]})],e,"identity",null),i([t.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"VarianceScaling",configParamIndices:[0]})],e,"varianceScaling",null),i([t.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"GlorotUniform",configParamIndices:[0]})],e,"glorotUniform",null),i([t.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"GlorotNormal",configParamIndices:[0]})],e,"glorotNormal",null),i([t.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"HeNormal",configParamIndices:[0]})],e,"heNormal",null),i([t.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"LeCunNormal",configParamIndices:[0]})],e,"leCunNormal",null),i([t.doc({heading:"Initializers",namespace:"initializers",useDocsFrom:"Orthogonal",configParamIndices:[0]})],e,"orthogonal",null),e}(),Wr=function(){function e(){}return e.binaryAccuracy=function(e,t){return ct(e,t)},e.binaryCrossentropy=function(e,t){return pt(e,t)},e.categoricalAccuracy=function(e,t){return ht(e,t)},e.categoricalCrossentropy=function(e,t){return it(e,t)},e.cosineProximity=function(e,t){return lt(e,t)},e.prototype.meanAbsoluteError=function(e,t){return Xe(e,t)},e.prototype.meanAbsolutePercentageError=function(e,t){return $e(e,t)},e.prototype.MAPE=function(e,t){return $e(e,t)},e.prototype.mape=function(e,t){return $e(e,t)},e.meanSquaredError=function(e,t){return Je(e,t)},e.MSE=function(e,t){return Je(e,t)},e.mse=function(e,t){return Je(e,t)},i([t.doc({heading:"Metrics",namespace:"metrics",useDocsFrom:"meanAbsoluteError"})],e.prototype,"meanAbsoluteError",null),i([t.doc({heading:"Metrics",namespace:"metrics",useDocsFrom:"meanAbsolutePercentageError"})],e.prototype,"meanAbsolutePercentageError",null),i([t.doc({heading:"Metrics",namespace:"metrics",useDocsFrom:"binaryAccuracy"})],e,"binaryAccuracy",null),i([t.doc({heading:"Metrics",namespace:"metrics",useDocsFrom:"binaryCrossentropy"})],e,"binaryCrossentropy",null),i([t.doc({heading:"Metrics",namespace:"metrics",useDocsFrom:"categoricalAccuracy"})],e,"categoricalAccuracy",null),i([t.doc({heading:"Metrics",namespace:"metrics",useDocsFrom:"categoricalCrossentropy"})],e,"categoricalCrossentropy",null),i([t.doc({heading:"Metrics",namespace:"metrics",useDocsFrom:"cosineProximity"})],e,"cosineProximity",null),i([t.doc({heading:"Metrics",namespace:"metrics",useDocsFrom:"meanSquaredError"})],e,"meanSquaredError",null),e}(),Vr=function(){function e(){}return e.l1l2=function(e){return new ji(e)},e.l1=function(e){return Ut(e)},e.l2=function(e){return jt(e)},i([t.doc({heading:"Regularizers",namespace:"regularizers",useDocsFrom:"L1L2"})],e,"l1l2",null),i([t.doc({heading:"Regularizers",namespace:"regularizers",useDocsFrom:"L1L2"})],e,"l1",null),i([t.doc({heading:"Regularizers",namespace:"regularizers",useDocsFrom:"L1L2"})],e,"l2",null),e}(),qr=_r.model,Zr=_r.sequential,Kr=_r.loadModel,Gr=_r.input,Hr=Br,Jr=Ur,Xr=jr,$r=Wr,Yr=Vr;e.model=qr,e.sequential=Zr,e.loadModel=Kr,e.input=Gr,e.layers=Hr,e.constraints=Jr,e.initializers=Xr,e.metrics=$r,e.regularizers=Yr,e.Callback=Zn,e.CallbackList=Kn,e.CustomCallback=Jn,e.Model=oi,e.RNN=Nr,e.Sequential=Pr,e.SymbolicTensor=Sn,e.version_layers="0.6.1",Object.defineProperty(e,"__esModule",{value:!0})});